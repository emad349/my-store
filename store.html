<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title id="pgTitle">ูุชุฌุฑู</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;500;600;700;900&display=swap" rel="stylesheet">
<style>
:root{
  --p:#7c3aed;--p2:#6d28d9;
  --s:#2563eb;--s2:#1d4ed8;
  --nv:#0d1035;--nv2:#141847;
  --ac:#a78bfa;
  --gr:#64748b;--bd:#e2e8f0;
  --tx:#1e293b;--tx2:#475569;
  --st:#f59e0b;--re:#ef4444;--gn:#10b981;
  --bg:#f8f7ff;--fbg:#0d1035;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Cairo',sans-serif;background:var(--bg);color:var(--tx);direction:rtl;}
#announceBar{overflow:hidden;height:36px;display:flex;align-items:center;}
.atrack{display:flex;animation:sc 28s linear infinite;white-space:nowrap;gap:3rem;}
@keyframes sc{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}
.ait{padding:0 1.2rem;font-size:.82rem;color:#fff;}
header{background:#fff;border-bottom:1px solid var(--bd);position:sticky;top:0;z-index:200;box-shadow:0 1px 10px rgba(0,0,0,.06);}
.htop{display:flex;align-items:center;justify-content:space-between;padding:0 2rem;height:68px;max-width:1280px;margin:0 auto;gap:1rem;}
.logo{display:flex;align-items:center;gap:.7rem;cursor:pointer;text-decoration:none;}
.logo-icon{width:42px;height:42px;border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.3rem;font-weight:900;flex-shrink:0;overflow:hidden;}
.logo-icon img{width:100%;height:100%;object-fit:cover;}
.logo-name{font-size:1.35rem;font-weight:900;color:var(--nv);line-height:1.1;}
.logo-tag{font-size:.68rem;color:var(--gr);}
.hsearch{flex:1;max-width:480px;position:relative;}
.hsearch input{width:100%;border:1.5px solid var(--bd);border-radius:10px;padding:.6rem 1rem .6rem 2.8rem;font-family:'Cairo',sans-serif;font-size:.9rem;outline:none;background:var(--bg);transition:border-color .2s;}
.hsearch input:focus{border-color:var(--p);}
.hsi{position:absolute;left:10px;top:50%;transform:translateY(-50%);background:none;border:none;cursor:pointer;color:var(--gr);}
.hactions{display:flex;align-items:center;gap:.5rem;}
.hbtn{background:none;border:1px solid var(--bd);color:var(--tx);padding:.45rem .85rem;border-radius:9px;cursor:pointer;font-family:'Cairo',sans-serif;font-size:.84rem;font-weight:600;display:inline-flex;align-items:center;gap:.3rem;transition:all .2s;white-space:nowrap;text-decoration:none;}
.hbtn:hover{border-color:var(--p);color:var(--p);}
.hbtn.primary{background:linear-gradient(135deg,var(--p),var(--s));color:#fff;border:none;}
.hbtn.primary:hover{opacity:.9;}
.cc{background:#fff;color:var(--p);font-size:.7rem;font-weight:900;width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;}
.hnav{border-top:1px solid var(--bd);}
.hnav ul{display:flex;list-style:none;padding:0 2rem;max-width:1280px;margin:0 auto;overflow-x:auto;}
.hnav a{display:flex;align-items:center;gap:.3rem;padding:.6rem 1rem;color:var(--tx2);text-decoration:none;font-size:.87rem;font-weight:600;white-space:nowrap;border-bottom:2px solid transparent;transition:all .2s;}
.hnav a:hover,.hnav a.act{color:var(--p);border-bottom-color:var(--p);}
.cnt{max-width:1280px;margin:0 auto;padding:0 1.5rem;}
.sec{padding:2.5rem 0;}
.sec-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:1.5rem;}
.sec-ttl{font-size:1.25rem;font-weight:800;color:var(--nv);display:flex;align-items:center;gap:.5rem;}
.sec-ttl::before{content:'';display:inline-block;width:4px;height:1.1em;background:linear-gradient(var(--p),var(--s));border-radius:4px;}
.see-all{color:var(--p);font-size:.85rem;font-weight:700;cursor:pointer;border:1px solid rgba(109,40,217,.2);padding:.35rem .9rem;border-radius:7px;background:none;}
.hero{position:relative;display:flex;align-items:center;min-height:380px;padding:3rem 4rem;overflow:hidden;}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 60% 80% at 80% 50%,rgba(109,40,217,.4),transparent),radial-gradient(ellipse 40% 60% at 20% 80%,rgba(37,99,235,.3),transparent);}
.hcnt{position:relative;z-index:1;max-width:520px;}
.htag{display:inline-flex;align-items:center;background:rgba(167,139,250,.15);border:1px solid rgba(167,139,250,.3);color:var(--ac);font-size:.82rem;padding:.3rem .8rem;border-radius:50px;margin-bottom:1rem;}
.htitle{font-size:2.4rem;font-weight:900;color:#fff;line-height:1.2;margin-bottom:.8rem;}
.htitle .hl{background:linear-gradient(135deg,var(--ac),#60a5fa);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}
.hdesc{color:rgba(255,255,255,.7);font-size:.95rem;margin-bottom:1.8rem;line-height:1.7;}
.hbtns{display:flex;gap:.8rem;flex-wrap:wrap;}
.hbp{border:none;padding:.75rem 1.8rem;border-radius:10px;cursor:pointer;font-family:'Cairo',sans-serif;font-size:.95rem;font-weight:700;background:linear-gradient(135deg,var(--p),var(--s));color:#fff;transition:all .2s;}
.hbp:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(109,40,217,.4);}
.hbs{background:rgba(255,255,255,.1);color:#fff;border:1px solid rgba(255,255,255,.2);padding:.75rem 1.8rem;border-radius:10px;cursor:pointer;font-family:'Cairo',sans-serif;font-size:.95rem;font-weight:600;transition:all .2s;}
.hbs:hover{background:rgba(255,255,255,.18);}
.hstats{display:flex;gap:2rem;margin-top:2rem;}
.hsn{font-size:1.4rem;font-weight:900;color:#fff;}
.hsl{font-size:.78rem;color:rgba(255,255,255,.5);}
.hdeco{position:absolute;left:3rem;top:50%;transform:translateY(-50%);font-size:10rem;opacity:.07;pointer-events:none;}
.trust{background:#fff;border:1px solid var(--bd);border-radius:16px;padding:1.5rem 2rem;display:flex;align-items:center;justify-content:space-around;gap:1rem;flex-wrap:wrap;}
.ti{display:flex;align-items:center;gap:.8rem;}
.ti-ic{font-size:1.8rem;}
.ti-ttl{font-size:.88rem;font-weight:700;}
.ti-sub{font-size:.78rem;color:var(--gr);}
.tdv{width:1px;height:40px;background:var(--bd);}
.cgrid{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;}
.ccard{border-radius:14px;overflow:hidden;position:relative;cursor:pointer;aspect-ratio:16/9;display:flex;align-items:flex-end;transition:transform .2s;}
.ccard:hover{transform:translateY(-3px);}
.cbg{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-size:3.5rem;}
.cov{position:absolute;inset:0;background:linear-gradient(to top,rgba(13,16,53,.85),transparent);}
.clbl{position:relative;z-index:1;padding:1rem;color:#fff;font-weight:700;font-size:.9rem;width:100%;}
.ccount{font-size:.75rem;color:rgba(255,255,255,.6);font-weight:400;}
.pgrid{display:grid;grid-template-columns:repeat(4,1fr);gap:1.2rem;}
.pc{background:#fff;border-radius:14px;overflow:hidden;border:1px solid var(--bd);transition:all .25s;cursor:pointer;display:flex;flex-direction:column;}
.pc:hover{box-shadow:0 12px 40px rgba(109,40,217,.12);transform:translateY(-4px);border-color:rgba(109,40,217,.2);}
.pth{aspect-ratio:16/9;background:linear-gradient(135deg,#f0ebff,#e0f2fe);display:flex;align-items:center;justify-content:center;font-size:5rem;position:relative;overflow:hidden;}
html.dark .pth{background:linear-gradient(135deg,#1e2440,#172040);}
.pbdg{position:absolute;top:10px;right:10px;padding:.25rem .65rem;border-radius:7px;font-size:.72rem;font-weight:700;}
.bnn{background:linear-gradient(135deg,var(--p),var(--s));color:#fff;}
.bns{background:#fee2e2;color:var(--re);}
.bnh{background:#fef3c7;color:#92400e;}
.wbtn{position:absolute;top:10px;left:10px;background:#fff;border:none;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.12);font-size:.95rem;transition:all .2s;}
.wbtn:hover{transform:scale(1.1);}
.dcbdg{position:absolute;bottom:10px;right:10px;background:rgba(13,16,53,.82);color:var(--ac);font-size:.68rem;font-weight:700;padding:.2rem .55rem;border-radius:6px;display:flex;align-items:center;gap:.25rem;}
.pb{padding:1rem;flex:1;display:flex;flex-direction:column;gap:.35rem;}
.pnm{font-size:.92rem;font-weight:800;line-height:1.4;color:var(--nv);}
html.dark .pnm{color:var(--tx);}
.prt{display:flex;align-items:center;gap:.3rem;}
.sts{color:var(--st);font-size:.82rem;letter-spacing:.05em;}
.rc{font-size:.75rem;color:var(--gr);}
.ppr{display:flex;align-items:center;justify-content:space-between;margin-top:auto;padding-top:.4rem;border-top:1px solid var(--bd);}
html.dark .ppr{border-color:var(--bd);}
.pp{font-size:1.05rem;font-weight:900;color:var(--p);}
.po{font-size:.75rem;color:var(--gr);text-decoration:line-through;}
.abtn{background:linear-gradient(135deg,var(--p),var(--s));color:#fff;border:none;width:36px;height:36px;border-radius:9px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:1.1rem;flex-shrink:0;transition:all .2s;}
.abtn:hover{transform:scale(1.1);box-shadow:0 4px 12px rgba(109,40,217,.35);}
.promo{border-radius:16px;padding:2.5rem 3rem;display:flex;align-items:center;justify-content:space-between;overflow:hidden;position:relative;}
.promo-c{position:relative;z-index:1;}
.promo-tag{display:inline-block;background:rgba(255,255,255,.15);color:#fff;font-size:.78rem;padding:.25rem .7rem;border-radius:50px;margin-bottom:.6rem;}
.promo-ttl{font-size:1.6rem;font-weight:900;color:#fff;margin-bottom:.3rem;}
.promo-d{color:rgba(255,255,255,.7);font-size:.9rem;}
.promo-btn{background:#fff;border:none;padding:.8rem 2rem;border-radius:10px;font-family:'Cairo',sans-serif;font-size:.95rem;font-weight:800;cursor:pointer;transition:all .2s;position:relative;z-index:1;}
.promo-btn:hover{transform:scale(1.03);}
.rg{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;}
.rc2{background:#fff;border:1px solid var(--bd);border-radius:14px;padding:1.2rem;}
.rh{display:flex;align-items:center;gap:.7rem;margin-bottom:.8rem;}
.rav{width:42px;height:42px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:1rem;flex-shrink:0;}
.rnm{font-weight:700;font-size:.9rem;}
.rdt{font-size:.75rem;color:var(--gr);}
.rst{color:var(--st);font-size:.9rem;margin-bottom:.5rem;}
.rtx{font-size:.85rem;color:var(--tx2);line-height:1.6;}
.rprd{font-size:.78rem;color:var(--p);margin-top:.5rem;font-weight:600;}
.ft-top{display:grid;grid-template-columns:2fr 1fr 1fr 1fr;gap:2rem;padding:3rem 2rem;max-width:1280px;margin:0 auto;}
.fbl{display:flex;align-items:center;gap:.7rem;margin-bottom:1rem;}
.fbi{width:38px;height:38px;border-radius:9px;display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.2rem;font-weight:900;overflow:hidden;flex-shrink:0;}
.fbi img{width:100%;height:100%;object-fit:cover;}
.fbn{font-size:1.2rem;font-weight:900;color:#fff;}
.fbd{font-size:.85rem;color:rgba(255,255,255,.5);line-height:1.7;margin-bottom:1rem;}
.socs{display:flex;gap:.6rem;flex-wrap:wrap;}
.soc{width:36px;height:36px;border-radius:9px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:.95rem;color:#fff;text-decoration:none;transition:all .2s;border:1px solid rgba(255,255,255,.1);background:rgba(255,255,255,.07);}
.soc:hover{background:rgba(109,40,217,.45);border-color:var(--p);}
.fct{font-size:.95rem;font-weight:700;color:#fff;margin-bottom:1rem;}
.fls{list-style:none;display:flex;flex-direction:column;gap:.5rem;}
.fls a{color:rgba(255,255,255,.5);text-decoration:none;font-size:.85rem;transition:color .2s;}
.fls a:hover{color:var(--ac);}
.ft-bot{border-top:1px solid rgba(255,255,255,.07);padding:1.2rem 2rem;max-width:1280px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:.5rem;}
.ftcp{font-size:.8rem;color:rgba(255,255,255,.4);}
.paybdgs{display:flex;gap:.5rem;flex-wrap:wrap;}
.paybdg{background:rgba(255,255,255,.07);border:1px solid rgba(255,255,255,.08);border-radius:6px;padding:.25rem .6rem;font-size:.75rem;color:rgba(255,255,255,.4);}
#mobileNav{display:none;position:fixed;bottom:0;left:0;right:0;background:#fff;border-top:1px solid var(--bd);z-index:300;padding:.4rem 0 calc(.6rem + env(safe-area-inset-bottom));}
.mn-items{display:flex;justify-content:space-around;}
.mn-item{display:flex;flex-direction:column;align-items:center;gap:.15rem;cursor:pointer;padding:.3rem .5rem;border:none;background:none;color:var(--gr);font-family:'Cairo',sans-serif;font-size:.65rem;font-weight:600;transition:color .2s;flex:1;}
.mn-item:hover,.mn-item.act{color:var(--p);}
.mn-ic{font-size:1.25rem;}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.52);z-index:400;display:flex;align-items:flex-end;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s;}
.overlay.open{opacity:1;pointer-events:all;}
.sheet{background:#fff;border-radius:20px 20px 0 0;width:100%;max-width:540px;max-height:90vh;overflow-y:auto;transform:translateY(100%);transition:transform .35s cubic-bezier(.34,1.56,.64,1);}
.overlay.open .sheet{transform:translateY(0);}
.sh-handle{width:36px;height:4px;background:#e2e8f0;border-radius:4px;margin:.8rem auto;}
.sh-hd{display:flex;align-items:center;justify-content:space-between;padding:.5rem 1.5rem 1rem;}
.sh-ttl{font-size:1.1rem;font-weight:800;color:var(--nv);}
.sh-cls{background:none;border:none;cursor:pointer;color:var(--gr);font-size:1.3rem;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:8px;}
.sh-cls:hover{background:#f1f5f9;}
.sh-body{padding:0 1.5rem 2rem;}
.ce{text-align:center;padding:2.5rem 0;color:var(--gr);}
.ci{display:flex;align-items:center;gap:.8rem;padding:.8rem 0;border-bottom:1px solid var(--bd);}
.ci-img{width:55px;height:55px;background:linear-gradient(135deg,#f0ebff,#e0f2fe);border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:1.6rem;flex-shrink:0;}
.ci-info{flex:1;}
.ci-nm{font-size:.88rem;font-weight:700;margin-bottom:.15rem;}
.ci-pr{font-size:.9rem;font-weight:800;color:var(--p);}
.ci-qty{display:flex;align-items:center;gap:.5rem;margin-top:.3rem;}
.ci-qty button{background:var(--bd);border:none;width:22px;height:22px;border-radius:50%;cursor:pointer;font-size:.85rem;display:flex;align-items:center;justify-content:center;font-weight:700;}
.ci-qty span{font-size:.85rem;font-weight:700;min-width:16px;text-align:center;}
.ci-rm{background:none;border:none;color:var(--gr);cursor:pointer;font-size:1rem;}
.ci-rm:hover{color:var(--re);}
.csum{background:var(--bg);border-radius:12px;padding:1rem;margin-top:1rem;}
.crow{display:flex;justify-content:space-between;font-size:.88rem;color:var(--tx2);margin-bottom:.4rem;}
.crow.tot{color:var(--nv);font-weight:800;font-size:1rem;border-top:1px dashed var(--bd);margin-top:.5rem;padding-top:.5rem;}
.btn-co{width:100%;background:linear-gradient(135deg,var(--p),var(--s));color:#fff;border:none;padding:.9rem;border-radius:12px;font-family:'Cairo',sans-serif;font-size:1rem;font-weight:800;cursor:pointer;margin-top:1rem;}
.fg{margin-bottom:1rem;}
.fl{display:block;font-size:.82rem;color:var(--gr);margin-bottom:.4rem;font-weight:600;}
.fi{width:100%;border:1.5px solid var(--bd);border-radius:10px;padding:.7rem 1rem;font-family:'Cairo',sans-serif;font-size:.92rem;outline:none;background:#fafafe;color:var(--tx);transition:border-color .2s;}
.fi:focus{border-color:var(--p);}
.otp-row{display:flex;gap:.5rem;justify-content:center;margin:1rem 0;}
.otp-box{width:44px;height:50px;border:2px solid var(--bd);border-radius:12px;text-align:center;font-size:1.3rem;font-weight:800;font-family:'Cairo',sans-serif;outline:none;background:#fafafe;transition:border-color .2s;}
.otp-box:focus{border-color:var(--p);}
.btn-pri{width:100%;background:linear-gradient(135deg,var(--p),var(--s));color:#fff;border:none;padding:.85rem;border-radius:11px;font-family:'Cairo',sans-serif;font-size:.95rem;font-weight:800;cursor:pointer;margin-top:.3rem;}
.btn-pri:disabled{opacity:.55;cursor:not-allowed;}
.hint{text-align:center;font-size:.82rem;color:var(--gr);margin-top:.8rem;}
.hint span{color:var(--p);cursor:pointer;font-weight:700;}
.pd-img{width:100%;aspect-ratio:4/3;background:linear-gradient(135deg,#f0ebff,#e0f2fe);border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:7rem;margin-bottom:1.2rem;}
.pay-opts{display:flex;flex-direction:column;gap:.6rem;margin:.7rem 0 1rem;}
.pay-opt{display:flex;align-items:center;gap:.8rem;border:1.5px solid var(--bd);border-radius:11px;padding:.8rem 1rem;cursor:pointer;font-size:.9rem;font-weight:600;}
.pay-opt.sel{border-color:var(--p);background:rgba(109,40,217,.04);}
.qty-ctrl{display:flex;align-items:center;gap:.8rem;background:#f1f5f9;border-radius:10px;padding:.4rem .8rem;width:fit-content;}
.qty-btn{background:#fff;border:1px solid var(--bd);width:30px;height:30px;border-radius:7px;cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;font-weight:700;}
.qty-val{font-size:.95rem;font-weight:700;min-width:24px;text-align:center;}
.dlv-ov{position:fixed;inset:0;background:rgba(8,10,35,.93);backdrop-filter:blur(14px);z-index:900;display:flex;align-items:center;justify-content:center;padding:1rem;opacity:0;pointer-events:none;transition:opacity .4s;}
.dlv-ov.open{opacity:1;pointer-events:all;}
.dlv-card{background:#141847;border:1px solid rgba(167,139,250,.22);border-radius:24px;width:100%;max-width:480px;max-height:90vh;overflow-y:auto;transform:scale(.93);transition:transform .4s cubic-bezier(.34,1.56,.64,1);}
.dlv-ov.open .dlv-card{transform:scale(1);}
.dlv-hd{padding:2rem;text-align:center;}
.dlv-ic{font-size:3.5rem;margin-bottom:.5rem;}
.dlv-ttl{font-size:1.2rem;font-weight:900;color:#fff;}
.dlv-sub{color:rgba(255,255,255,.6);font-size:.85rem;margin-top:.3rem;}
.dlv-body{padding:1.2rem 1.5rem 1.5rem;}
.dlv-info{display:flex;justify-content:space-between;background:rgba(255,255,255,.04);border-radius:10px;padding:.8rem 1rem;margin-bottom:1.2rem;flex-wrap:wrap;gap:.5rem;}
.di-l{font-size:.7rem;color:rgba(255,255,255,.4);}
.di-v{font-size:.88rem;font-weight:700;color:#fff;}
.code-box{background:rgba(255,255,255,.06);border:1px solid rgba(167,139,250,.25);border-radius:14px;padding:1.2rem 1.5rem;text-align:center;margin-bottom:.6rem;}
.code-lbl{font-size:.7rem;color:rgba(255,255,255,.4);margin-bottom:.4rem;}
.code-val{font-size:1.6rem;font-weight:900;letter-spacing:.12em;color:var(--ac);font-family:monospace;}
.acc-box{background:rgba(255,255,255,.05);border:1px solid rgba(167,139,250,.22);border-radius:14px;padding:1rem 1.2rem;margin-bottom:.6rem;}
.acc-row{display:flex;align-items:center;justify-content:space-between;padding:.4rem 0;border-bottom:1px solid rgba(255,255,255,.06);}
.acc-row:last-child{border-bottom:none;}
.acc-l{font-size:.72rem;color:rgba(255,255,255,.4);}
.acc-v{font-size:.88rem;font-weight:700;color:#fff;font-family:monospace;word-break:break-all;}
.btn-cp{background:rgba(167,139,250,.14);border:1px solid rgba(167,139,250,.25);color:var(--ac);padding:.42rem 1rem;border-radius:8px;cursor:pointer;font-family:'Cairo',sans-serif;font-size:.82rem;font-weight:700;display:inline-flex;align-items:center;gap:.3rem;transition:all .2s;}
.btn-cp:hover{background:rgba(167,139,250,.25);}
.wa-row{display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.9rem;padding-top:.9rem;border-top:1px solid rgba(255,255,255,.08);}
.btn-wa-c{flex:1;background:rgba(37,211,102,.1);border:1px solid rgba(37,211,102,.25);color:#25d366;padding:.6rem .7rem;border-radius:9px;cursor:pointer;font-family:'Cairo',sans-serif;font-size:.82rem;font-weight:700;display:flex;align-items:center;justify-content:center;gap:.4rem;}
.btn-wa-o{flex:1;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);color:rgba(255,255,255,.6);padding:.6rem .7rem;border-radius:9px;cursor:pointer;font-family:'Cairo',sans-serif;font-size:.82rem;font-weight:700;display:flex;align-items:center;justify-content:center;gap:.4rem;}
.dlv-note{background:rgba(245,158,11,.06);border:1px solid rgba(245,158,11,.18);border-radius:10px;padding:.7rem 1rem;color:rgba(255,255,255,.6);font-size:.78rem;line-height:1.6;margin-top:1rem;}
.dlv-acts{display:flex;gap:.7rem;margin-top:1rem;}
.dlv-p{flex:1;background:linear-gradient(135deg,var(--p),var(--s));color:#fff;border:none;padding:.8rem;border-radius:11px;font-family:'Cairo',sans-serif;font-size:.9rem;font-weight:800;cursor:pointer;}
.dlv-s{background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.1);color:rgba(255,255,255,.6);padding:.8rem 1.2rem;border-radius:11px;font-family:'Cairo',sans-serif;font-size:.9rem;font-weight:600;cursor:pointer;}
.toast{position:fixed;bottom:80px;left:50%;transform:translateX(-50%) translateY(20px);background:var(--nv);color:#fff;padding:.7rem 1.4rem;border-radius:50px;font-size:.88rem;font-weight:600;z-index:9999;opacity:0;transition:all .3s;white-space:nowrap;box-shadow:0 4px 20px rgba(0,0,0,.25);pointer-events:none;}
.toast.show{opacity:1;transform:translateX(-50%) translateY(0);}
@media(min-width:769px){.toast{bottom:1.5rem;}}
.spin{display:inline-block;animation:spin .8s linear infinite;}
@keyframes spin{to{transform:rotate(360deg)}}
@media(max-width:1100px){.pgrid{grid-template-columns:repeat(3,1fr);}.cgrid{grid-template-columns:repeat(2,1fr);}}
@media(max-width:768px){
  .pgrid{grid-template-columns:repeat(2,1fr);gap:.8rem;}
  .hero{padding:2rem 1.5rem;min-height:260px;}.htitle{font-size:1.6rem;}.hdeco{display:none;}
  .htop{padding:0 1rem;}.hsearch{display:none;}
  .hnav ul{padding:0 .5rem;overflow-x:auto;}
  .hnav a{padding:.6rem .7rem;font-size:.8rem;}
  .cgrid{grid-template-columns:repeat(2,1fr);}
  .cnt{padding:0 1rem;}
  #mobileNav{display:block;}
  .ft-top{grid-template-columns:1fr 1fr;}
  .ft-top>div:first-child{grid-column:1/-1;}
  .rg{grid-template-columns:1fr;}
  .trust{justify-content:flex-start;}.tdv{display:none;}
  .promo{flex-direction:column;gap:1rem;}
  body{padding-bottom:65px;}
}
@media(max-width:480px){.ft-top{grid-template-columns:1fr;}}
/* โโ MOBILE IMPROVEMENTS โโ */
@media(max-width:480px){
  .htop{padding:0 .7rem;gap:.5rem;}
  .hbtn{padding:.4rem .6rem;font-size:.78rem;}
  .hbtn.primary{padding:.4rem .75rem;}
  .logo-name{font-size:1.1rem;}
  .pgrid{grid-template-columns:repeat(2,1fr);gap:.6rem;}
  .hero{padding:1.8rem 1rem;min-height:220px;}
  .htitle{font-size:1.35rem;}
  .hstats{gap:1rem;}
  .hsn{font-size:1.1rem;}
  .cnt{padding:0 .75rem;}
  .trust{padding:1rem;}
  .promo{padding:1.5rem 1.2rem;}
  .promo-ttl{font-size:1.2rem;}
}
/* โโ DARK MODE โโ */
html.dark{
  --tx:#e2e8f0;--tx2:#cbd5e1;--gr:#94a3b8;--bd:#2e3656;
  --bg:#0e1127;--nv:#0a0d20;--nv2:#141730;
  --ac:#c4b5fd;
}
html.dark body{background:var(--bg);}
html.dark header{background:#131729;border-color:var(--bd);}
html.dark .hnav{border-color:var(--bd);}
html.dark .logo-name{color:#e2e8f0;}
html.dark .hsearch input{background:#1e2440;border-color:var(--bd);color:var(--tx);}
html.dark .hbtn{background:#1e2440;border-color:var(--bd);color:var(--tx);}
html.dark .pc,.html.dark .rc2{background:#131729;border-color:var(--bd);}
html.dark .pc{background:#131729;border-color:var(--bd);}
html.dark .pth{background:linear-gradient(135deg,#1e2440,#172040);}
html.dark .rc2{background:#131729;border-color:var(--bd);}
html.dark .trust{background:#131729;border-color:var(--bd);}
html.dark .sheet{background:#131729;}
html.dark .sh-cls:hover{background:#1e2440;}
html.dark .fi{background:#1e2440;border-color:var(--bd);color:var(--tx);}
html.dark .ci{border-color:var(--bd);}
html.dark .ci-img{background:#1e2440;}
html.dark .csum{background:#0e1127;}
html.dark .qty-ctrl{background:#1e2440;}
html.dark .qty-btn{background:#131729;border-color:var(--bd);color:var(--tx);}
html.dark .pay-opt{border-color:var(--bd);color:var(--tx);}
html.dark .dlv-card{background:#0e1127;}
html.dark .pnm,.html.dark .ci-nm{color:var(--tx);}
html.dark .pnm{color:var(--tx);}
html.dark .ci-nm{color:var(--tx);}
html.dark .otp-box{background:#1e2440;border-color:var(--bd);color:var(--tx);}
html.dark #mobileNav{background:#131729;border-color:var(--bd);}
html.dark .mn-item{color:var(--gr);}
html.dark .sh-ttl{color:var(--tx);}
html.dark .see-all{color:var(--p);}
html.dark .sec-ttl{color:var(--tx);}
html.dark .timer-badge{background:#1e2440;}
/* โโ PRODUCT FULL PAGE โโ */
#prodFullPage{position:fixed;inset:0;background:var(--bg);z-index:600;overflow-y:auto;display:none;animation:slideIn .3s ease;}
#prodFullPage.open{display:block;}
@keyframes slideIn{from{transform:translateX(30px);opacity:0}to{transform:translateX(0);opacity:1}}
.pfp-header{background:#fff;border-bottom:1px solid var(--bd);padding:.8rem 1.5rem;display:flex;align-items:center;gap:.8rem;position:sticky;top:0;z-index:10;}
html.dark .pfp-header{background:#131729;border-color:var(--bd);}
.pfp-back{background:none;border:1px solid var(--bd);border-radius:9px;padding:.45rem .9rem;cursor:pointer;font-family:'Cairo',sans-serif;font-size:.85rem;color:var(--tx);display:flex;align-items:center;gap:.3rem;transition:all .2s;}
.pfp-back:hover{border-color:var(--p);color:var(--p);}
html.dark .pfp-back{background:#1e2440;border-color:var(--bd);color:var(--tx);}
.pfp-title{font-size:1rem;font-weight:800;color:var(--nv);}
html.dark .pfp-title{color:var(--tx);}
.pfp-body{max-width:1100px;margin:0 auto;padding:2rem 1.5rem;}
.pfp-layout{display:grid;grid-template-columns:1fr 1fr;gap:2.5rem;align-items:start;}
@media(max-width:768px){.pfp-layout{grid-template-columns:1fr;gap:1.2rem;}}
/* ุงูุตูุฑุฉ ูููู */
.pfp-gallery{position:sticky;top:80px;}
.pfp-main-img{width:100%;aspect-ratio:1;background:linear-gradient(135deg,#f0ebff,#e0f2fe);border-radius:18px;display:flex;align-items:center;justify-content:center;font-size:10rem;position:relative;overflow:hidden;border:1px solid var(--bd);}
html.dark .pfp-main-img{background:linear-gradient(135deg,#1e2440,#172040);border-color:var(--bd);}
.pfp-avail-badge{position:absolute;bottom:14px;left:14px;background:rgba(13,16,53,.85);color:var(--ac);font-size:.75rem;font-weight:700;padding:.35rem .8rem;border-radius:8px;display:flex;align-items:center;gap:.3rem;}
/* ุงููุนูููุงุช ูุณุงุฑ */
.pfp-cat-tag{display:inline-flex;align-items:center;background:rgba(109,40,217,.08);border:1px solid rgba(109,40,217,.15);color:var(--p);font-size:.75rem;font-weight:700;padding:.25rem .75rem;border-radius:50px;margin-bottom:.8rem;}
.pfp-name{font-size:1.6rem;font-weight:900;color:var(--nv);line-height:1.3;margin-bottom:.7rem;}
html.dark .pfp-name{color:var(--tx);}
.pfp-rating-row{display:flex;align-items:center;gap:.6rem;margin-bottom:1rem;padding-bottom:1rem;border-bottom:1px solid var(--bd);}
html.dark .pfp-rating-row{border-color:var(--bd);}
.pfp-stars{color:var(--st);font-size:1rem;}
.pfp-rcount{font-size:.82rem;color:var(--gr);}
.pfp-price-wrap{margin-bottom:1.2rem;}
.pfp-price-main{font-size:2.2rem;font-weight:900;color:var(--p);}
.pfp-price-old{font-size:1rem;color:var(--gr);text-decoration:line-through;margin-right:.5rem;}
.pfp-price-disc{background:#fee2e2;color:var(--re);font-size:.8rem;font-weight:800;padding:.25rem .6rem;border-radius:6px;margin-right:.4rem;}
.pfp-desc{font-size:.92rem;color:var(--tx2);line-height:1.9;margin-bottom:1.2rem;}
.pfp-digital-badge{background:rgba(109,40,217,.06);border:1px solid rgba(109,40,217,.18);border-radius:12px;padding:.9rem 1.1rem;margin-bottom:1.2rem;display:flex;align-items:center;gap:.7rem;font-size:.88rem;color:var(--p);font-weight:700;}
html.dark .pfp-digital-badge{background:rgba(109,40,217,.12);border-color:rgba(109,40,217,.25);}
.pfp-features{display:grid;grid-template-columns:1fr 1fr;gap:.6rem;margin-bottom:1.4rem;}
.pfp-feat{background:#f8f7ff;border:1px solid var(--bd);border-radius:10px;padding:.7rem .9rem;font-size:.82rem;color:var(--tx2);display:flex;align-items:center;gap:.5rem;}
html.dark .pfp-feat{background:#1e2440;border-color:var(--bd);color:var(--tx2);}
.pfp-buy-row{display:flex;align-items:center;gap:.8rem;margin-bottom:1rem;}
.pfp-qty{display:flex;align-items:center;gap:.6rem;background:#f1f5f9;border-radius:10px;padding:.5rem .9rem;border:1px solid var(--bd);}
html.dark .pfp-qty{background:#1e2440;border-color:var(--bd);}
.pfp-qty button{background:none;border:none;font-size:1.4rem;cursor:pointer;color:var(--p);font-weight:900;line-height:1;width:24px;text-align:center;}
.pfp-qty span{font-size:1rem;font-weight:800;min-width:28px;text-align:center;color:var(--tx);}
.pfp-add-btn{flex:1;background:linear-gradient(135deg,var(--p),var(--s));color:#fff;border:none;padding:.9rem 1.5rem;border-radius:12px;font-family:'Cairo',sans-serif;font-size:1rem;font-weight:800;cursor:pointer;transition:all .2s;display:flex;align-items:center;justify-content:center;gap:.4rem;}
.pfp-add-btn:hover{opacity:.9;transform:translateY(-1px);box-shadow:0 8px 20px rgba(109,40,217,.3);}
.pfp-revs{margin-top:2.5rem;padding-top:2rem;border-top:1px solid var(--bd);}
html.dark .pfp-revs{border-color:var(--bd);}
.pfp-divider{border:none;border-top:1px solid var(--bd);margin:1.5rem 0;}
html.dark .pfp-divider{border-color:var(--bd);}
/* ุญุฐู ุงููุฏูู */
.pfp-img{display:none;}
.pfp-meta{display:none;}
.pfp-price-big{font-size:2rem;font-weight:900;color:var(--p);}
.pfp-actions{display:none;}
/* โโ CATEGORY PAGE โโ */
#catPage{position:fixed;inset:0;background:var(--bg);z-index:600;overflow-y:auto;display:none;animation:slideIn .3s ease;}
#catPage.open{display:block;}
.cp-header{background:linear-gradient(135deg,var(--nv),var(--nv2));padding:1.5rem;display:flex;align-items:center;gap:1rem;}
.cp-back{background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:9px;padding:.45rem .9rem;cursor:pointer;font-family:'Cairo',sans-serif;font-size:.85rem;color:#fff;display:flex;align-items:center;gap:.3rem;}
.cp-back:hover{background:rgba(255,255,255,.18);}
.cp-info h2{font-size:1.4rem;font-weight:900;color:#fff;}
.cp-info p{font-size:.85rem;color:rgba(255,255,255,.6);}
.cp-body{max-width:1280px;margin:0 auto;padding:1.5rem;}
/* โโ REVIEW SECTION โโ */
.rev-section{margin-top:1.5rem;}
.rev-hd{display:flex;align-items:center;justify-content:space-between;margin-bottom:1rem;}
.rev-ttl{font-size:1rem;font-weight:800;color:var(--nv);}
html.dark .rev-ttl{color:var(--tx);}
.rev-stars-inp{display:flex;gap:.3rem;margin:.5rem 0;}
.rev-star{font-size:1.5rem;cursor:pointer;opacity:.3;transition:opacity .2s;}
.rev-star.sel{opacity:1;}
.rev-card{background:#fff;border:1px solid var(--bd);border-radius:12px;padding:1rem;margin-bottom:.8rem;}
html.dark .rev-card{background:#131729;border-color:var(--bd);}
.rev-author{font-weight:700;font-size:.88rem;margin-bottom:.2rem;}
.rev-date{font-size:.75rem;color:var(--gr);}
.rev-text{font-size:.85rem;color:var(--tx2);margin-top:.4rem;line-height:1.6;}
.rev-form{background:#f8f7ff;border-radius:14px;padding:1.2rem;margin-top:1rem;}
html.dark .rev-form{background:#1e2440;}
html.dark .rnm{color:var(--tx);}
html.dark .rtx{color:var(--tx2);}
html.dark .pfp-back{background:#1e2440;border-color:var(--bd);color:var(--tx);}
html.dark .pfp-title{color:var(--tx);}
html.dark #prodFullPage{background:var(--bg);}
html.dark #catPage{background:var(--bg);}
html.dark .ci-nm{color:var(--tx);}
html.dark .csum .crow{color:var(--tx2);}
html.dark .csum .crow.tot{color:var(--tx);}
html.dark .pay-opt{color:var(--tx);background:#1e2440;}
html.dark .pay-opt.sel{background:rgba(109,40,217,.15);}
html.dark .rev-card{background:#131729;border-color:var(--bd);}
html.dark .rev-author{color:var(--tx);}
html.dark .rev-text{color:var(--tx2);}
html.dark .pfp-divider{border-color:var(--bd);}
html.dark #ls-tabs{background:#1e2440 !important;}
html.dark #ls-tabs button:not([style*="linear-gradient"]){color:var(--tx2);}
html.dark .hnav a{color:var(--tx2);}
html.dark .hnav a:hover,html.dark .hnav a.act{color:var(--p);}
html.dark #darkBtn{background:#131729;border-color:var(--bd);}
html.dark .pfp-actions>div{background:#1e2440;border-color:var(--bd);}
html.dark .pfp-actions>div button{color:var(--p);}
html.dark .pfp-actions>div span{color:var(--tx);}
html.dark h2,html.dark .pfp-meta h2{color:var(--tx);}
html.dark .pfp-price-big{color:var(--p);}
html.dark .pfp-body p{color:var(--tx2);}
html.dark .myOrdersSheet .sh-body>div>div{background:#131729 !important;border-color:var(--bd) !important;}
html.dark .sh-body .fl{color:var(--tx2);}
html.dark .see-all{border-color:rgba(167,139,250,.3);}

</style>
</head>
<body>

<!-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
     ๐ฅ  FIREBASE CONFIG  โ ุถุน ุจูุงูุงุชู ููุง
     ุงูุชุญ Firebase Console โ ุฅุนุฏุงุฏุงุช ุงููุดุฑูุน โ ุชุทุจููุงุชู
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ -->
<script>
const FIREBASE_CONFIG = {
  apiKey:            "AIzaSyAMpqsqJtZ5OIDDPyn64VUUZssEkaVzy5s",
  authDomain:        "my-store-6a072.firebaseapp.com",
  projectId:         "my-store-6a072",
  storageBucket:     "my-store-6a072.firebasestorage.app",
  messagingSenderId: "637762823797",
  appId:             "1:637762823797:web:e01355f7d37c5080f07a3c"
};
</script>

<!-- Firebase Firestore only (no Auth needed) -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<!-- EmailJS SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<script>
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
//  โ๏ธ EmailJS CONFIG โ ุถุน ุจูุงูุงุชู ููุง
//  ุณุฌูู ูู emailjs.com โ My Account โ API Keys
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
const EMAILJS_CONFIG = {
  publicKey:   'YOUR_PUBLIC_KEY',    // ูู ุตูุญุฉ Account โ API Keys
  serviceId:   'YOUR_SERVICE_ID',    // ูู Email Services
  templateId:  'YOUR_TEMPLATE_ID',   // ูู Email Templates
};
emailjs.init(EMAILJS_CONFIG.publicKey);
</script>


<div id="announceBar"><div class="atrack" id="atrack"></div></div>

<header>
  <div class="htop">
    <div class="logo" id="storeLogo" onclick="scrollTo({top:0,behavior:'smooth'})"></div>
    <div class="hsearch"><button class="hsi">๐</button><input type="text" id="searchInp" placeholder="ุงุจุญุซ ุนู ููุชุฌ..." oninput="liveSearch()"></div>
    <div class="hactions" id="hactions"></div>
  </div>
  <nav class="hnav"><ul id="navLinks"></ul></nav>
</header>

<main>
  <div class="hero" id="heroSection">
    <div class="hcnt">
      <div class="htag" id="heroTag"></div>
      <h1 class="htitle"><span id="heroL1"></span><br><span class="hl" id="heroL2"></span></h1>
      <p class="hdesc" id="heroDesc"></p>
      <div class="hbtns">
        <button class="hbp" id="hBtn1" onclick="document.getElementById('prodsec').scrollIntoView({behavior:'smooth'})"></button>
        <button class="hbs" id="hBtn2"></button>
      </div>
      <div class="hstats" id="heroStats"></div>
    </div>
    <div class="hdeco" id="heroDeco"></div>
  </div>
  <div class="cnt" style="margin-top:1.5rem;"><div class="trust" id="trustBar"></div></div>
  <div class="cnt sec">
    <div class="sec-hd"><div class="sec-ttl" id="catSecTitle">ุงุจุฏุฃ ุงูุชุณูู</div></div>
    <div class="cgrid" id="catsGrid"></div>
  </div>
  <div class="cnt sec" id="prodsec">
    <div class="sec-hd">
      <div class="sec-ttl" id="prodsTitle">ุงูุฃูุซุฑ ูุจูุนุงู</div>
      <button class="see-all" onclick="openCatPage('all')">ุนุฑุถ ุงููู</button>
    </div>
    <div class="pgrid" id="prodsGrid"></div>
  </div>
  <div class="cnt" style="padding-bottom:2.5rem;" id="promoWrap">
    <div class="promo" id="promoBnr">
      <div class="promo-c">
        <div class="promo-tag" id="promoTag"></div>
        <div class="promo-ttl" id="promoTitle"></div>
        <div class="promo-d" id="promoDesc"></div>
      </div>
      <button class="promo-btn" id="promoBtn"></button>
    </div>
  </div>
  <div class="cnt sec">
    <div class="sec-hd"><div class="sec-ttl" id="featTitle">ุฃุจุฑุฒ ุงูููุชุฌุงุช</div></div>
    <div class="pgrid" id="featGrid"></div>
  </div>
  <div class="cnt sec">
    <div class="sec-hd"><div class="sec-ttl">ุขุฑุงุก ุงูุนููุงุก</div></div>
    <div class="rg" id="reviewsGrid"></div>
  </div>
</main>

<footer id="siteFooter">
  <div class="ft-top" id="footerTop"></div>
  <div class="ft-bot" id="footerBot"></div>
</footer>

<div id="mobileNav"><div class="mn-items" id="mnItems"></div></div>
<!-- โโโโ PRODUCT FULL PAGE โโโโ -->
<div id="prodFullPage">
  <div class="pfp-header">
    <button class="pfp-back" onclick="closeProdPage()">โ ุฑุฌูุน</button>
    <div class="pfp-title" id="pfpTitle">ุชูุงุตูู ุงูููุชุฌ</div>
  </div>
  <div class="pfp-body" id="pfpBody"></div>
</div>

<!-- โโโโ CATEGORY PAGE โโโโ -->
<div id="catPage">
  <div class="cp-header">
    <button class="cp-back" onclick="closeCatPage()">โ ุฑุฌูุน</button>
    <div class="cp-info">
      <h2 id="cpName"></h2>
      <p id="cpCount"></p>
    </div>
  </div>
  <div class="cp-body">
    <div class="pgrid" id="cpGrid"></div>
  </div>
</div>

<!-- โโโโ DARK MODE TOGGLE โโโโ -->
<button id="darkBtn" onclick="toggleDark()" style="position:fixed;bottom:80px;left:1rem;z-index:350;background:#fff;border:1px solid var(--bd);border-radius:50%;width:44px;height:44px;font-size:1.2rem;cursor:pointer;box-shadow:0 4px 14px rgba(0,0,0,.15);transition:all .2s;" title="ุงููุถุน ุงูุฏุงูู">๐</button>

<div class="toast" id="toast"></div>

<!-- CODE DELIVERY OVERLAY -->
<div class="dlv-ov" id="dlvOv">
  <div class="dlv-card">
    <div class="dlv-hd" id="dlvHead"></div>
    <div class="dlv-body">
      <div class="dlv-info" id="dlvInfo"></div>
      <div id="dlvCodes"></div>
      <div class="dlv-note">โ๏ธ ุงุญุชูุธ ุจูุฐุง ุงูููุฏ ูู ููุงู ุขูู. ูู ููุฏ ููุณุชุฎุฏู ูุฑุฉ ูุงุญุฏุฉ ููุท ููู ููุนุฑุถ ูุฑุฉ ุฃุฎุฑู ุจุนุฏ ุฅุบูุงู ูุฐู ุงููุงูุฐุฉ.</div>
      <div class="dlv-acts">
        <button class="dlv-p" onclick="closeDlv()">โ ูููุชุ ุดูุฑุงู!</button>
        <button class="dlv-s" onclick="showToast('๐ธ ุงูุชูุท ุตูุฑุฉ ุงูุดุงุดุฉ ุงูุขู ููุงุญุชูุงุธ ุจููุฏู')">๐ธ ุญูุธ ุตูุฑุฉ</button>
      </div>
    </div>
  </div>
</div>

<!-- โโ LOGIN / REGISTER SHEET โโ -->
<div class="overlay" id="loginSheet" onclick="bgClose(event,'loginSheet')">
  <div class="sheet"><div class="sh-handle"></div>
    <div class="sh-hd">
      <div class="sh-ttl" id="loginSheetTitle">ุชุณุฌูู ุงูุฏุฎูู</div>
      <button class="sh-cls" onclick="closeSheet('loginSheet')">โ</button>
    </div>
    <div class="sh-body">

      <!-- ุชุจููุจุงุช -->
      <div id="ls-tabs" style="display:flex;background:#f1f0fa;border-radius:12px;padding:.25rem;margin-bottom:1.3rem;gap:.25rem;">
        <button id="tab-login" onclick="switchAuthTab('login')" style="flex:1;padding:.6rem;border:none;border-radius:9px;font-family:Cairo,sans-serif;font-size:.88rem;font-weight:700;cursor:pointer;background:linear-gradient(135deg,var(--p),var(--s));color:#fff;transition:all .2s;">ุชุณุฌูู ุงูุฏุฎูู ๐</button>
        <button id="tab-register" onclick="switchAuthTab('register')" style="flex:1;padding:.6rem;border:none;border-radius:9px;font-family:Cairo,sans-serif;font-size:.88rem;font-weight:700;cursor:pointer;background:transparent;color:var(--gr);transition:all .2s;">ุญุณุงุจ ุฌุฏูุฏ โจ</button>
      </div>

      <!-- STEP 1 โ ุฅุฏุฎุงู ุงูุฅูููู -->
      <div id="ls1">
        <div id="ls1-welcome" style="display:none;background:linear-gradient(135deg,rgba(109,40,217,.08),rgba(37,99,235,.05));border:1px solid rgba(109,40,217,.15);border-radius:10px;padding:.7rem 1rem;margin-bottom:.9rem;font-size:.88rem;font-weight:700;color:var(--p);"></div>

        <div class="fg" id="ls1-name-row" style="display:none;">
          <label class="fl">ุงูุงุณู ุงููุงูู</label>
          <input type="text" class="fi" id="regName" placeholder="ูุญูุฏ ุนุจุฏุงููู ุงูุฃุญูุฏู (ุงูุงุณู ุงูุซูุงุซู)">
        </div>

        <div class="fg">
          <label class="fl">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label>
          <input type="email" class="fi" id="emailF" placeholder="ุจุฑูุฏู@gmail.com" autocomplete="email" onkeydown="if(event.key==='Enter')doSendOTP()">
        </div>

        <button class="btn-pri" id="sendOtpBtn" onclick="doSendOTP()">ุฅุฑุณุงู ุฑูุฒ ุงูุชุญูู ๐ง</button>
        <p style="text-align:center;font-size:.72rem;color:var(--gr);margin-top:.8rem;">๐ ุณูุตูู ุฑูุฒ ููููู ูู 6 ุฃุฑูุงู ุนูู ุจุฑูุฏู</p>
      </div>

      <!-- STEP 2 โ ุฅุฏุฎุงู ุฑูุฒ OTP -->
      <div id="ls2" style="display:none;">
        <p style="text-align:center;color:var(--gr);font-size:.88rem;margin-bottom:.3rem;">ุฃุฏุฎู ุฑูุฒ ุงูุชุญูู ุงููุฑุณู ุฅูู</p>
        <p style="text-align:center;font-size:.95rem;font-weight:800;color:var(--p);margin-bottom:1.2rem;word-break:break-all;" id="ls2-email"></p>

        <!-- ุตูุงุฏูู OTP -->
        <div class="otp-row">
          <input type="text" class="otp-box" maxlength="1" inputmode="numeric" oninput="otpN(this,0)" onkeydown="otpBack(event,this,0)">
          <input type="text" class="otp-box" maxlength="1" inputmode="numeric" oninput="otpN(this,1)" onkeydown="otpBack(event,this,1)">
          <input type="text" class="otp-box" maxlength="1" inputmode="numeric" oninput="otpN(this,2)" onkeydown="otpBack(event,this,2)">
          <input type="text" class="otp-box" maxlength="1" inputmode="numeric" oninput="otpN(this,3)" onkeydown="otpBack(event,this,3)">
          <input type="text" class="otp-box" maxlength="1" inputmode="numeric" oninput="otpN(this,4)" onkeydown="otpBack(event,this,4)">
          <input type="text" class="otp-box" maxlength="1" inputmode="numeric" oninput="otpN(this,5)" onkeydown="otpBack(event,this,5)">
        </div>

        <!-- ุนุฏุงุฏ ุงูุชูุงุก ุงูุตูุงุญูุฉ -->
        <p style="text-align:center;font-size:.8rem;color:var(--gr);margin-bottom:.8rem;">
          ุงูุฑูุฒ ุตุงูุญ ูู <span id="otpTimer" style="color:var(--p);font-weight:800;">10:00</span>
        </p>

        <button class="btn-pri" id="verifyOtpBtn" onclick="doVerifyOTP()">ุชุฃููุฏ ุงูุฑูุฒ โ</button>
        <div class="hint" style="margin-top:.9rem;">
          ุชุบููุฑ ุงูุจุฑูุฏุ <span onclick="backToEmail()" style="color:var(--p);cursor:pointer;font-weight:700;">ุฑุฌูุน</span>
          &nbsp;ยท&nbsp;
          ูู ูุตููุ <span onclick="doSendOTP(true)" style="color:var(--p);cursor:pointer;font-weight:700;">ุฅุนุงุฏุฉ ุงูุฅุฑุณุงู</span>
        </div>
      </div>

      <!-- STEP 3 โ ูุฌุงุญ -->
      <div id="ls3" style="display:none;">
        <div style="text-align:center;padding:1.5rem 0;">
          <div style="width:72px;height:72px;background:linear-gradient(135deg,var(--p),var(--s));border-radius:50%;display:flex;align-items:center;justify-content:center;margin:0 auto 1rem;font-size:2rem;color:#fff;">โ</div>
          <div style="font-size:1.2rem;font-weight:900;margin-bottom:.3rem;" id="ls3-greeting">ุฃููุงู ูุณููุงู!</div>
          <div style="font-size:1rem;font-weight:700;color:var(--p);" id="ls3-name"></div>
          <div style="font-size:.8rem;color:var(--gr);margin-top:.2rem;" id="ls3-phone"></div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- CART SHEET -->
<div class="overlay" id="cartSheet" onclick="bgClose(event,'cartSheet')">
  <div class="sheet"><div class="sh-handle"></div>
    <div class="sh-hd"><div class="sh-ttl">๐ ุณูุฉ ุงูุชุณูู</div><button class="sh-cls" onclick="closeSheet('cartSheet')">โ</button></div>
    <div class="sh-body" id="cartBody"></div>
  </div>
</div>

<!-- PRODUCT DETAIL -->
<div class="overlay" id="pdSheet" onclick="bgClose(event,'pdSheet')">
  <div class="sheet" style="max-width:550px;"><div class="sh-handle"></div>
    <div class="sh-hd"><div class="sh-ttl" id="pdTitle"></div><button class="sh-cls" onclick="closeSheet('pdSheet')">โ</button></div>
    <div class="sh-body" id="pdBody"></div>
  </div>
</div>

<!-- CHECKOUT -->
<div class="overlay" id="coSheet" onclick="bgClose(event,'coSheet')">
  <div class="sheet"><div class="sh-handle"></div>
    <div class="sh-hd"><div class="sh-ttl">ุฅุชูุงู ุงูุทูุจ</div><button class="sh-cls" onclick="closeSheet('coSheet')">โ</button></div>
    <div class="sh-body" id="coBody"></div>
  </div>
</div>

<!-- MY ORDERS -->
<div class="overlay" id="myOrdersSheet" onclick="bgClose(event,'myOrdersSheet')">
  <div class="sheet" style="max-width:580px;"><div class="sh-handle"></div>
    <div class="sh-hd">
      <div class="sh-ttl">๐ค ุญุณุงุจู ูุทูุจุงุชู</div>
      <div style="display:flex;gap:.5rem;">
        <button class="sh-cls" style="background:rgba(239,68,68,.08);color:var(--re);font-size:.78rem;width:auto;padding:.3rem .7rem;border-radius:7px;font-family:Cairo,sans-serif;font-weight:700;" onclick="doLogout();closeSheet('myOrdersSheet')">ุฎุฑูุฌ โป</button>
        <button class="sh-cls" onclick="closeSheet('myOrdersSheet')">โ</button>
      </div>
    </div>
    <div class="sh-body">
      <div style="background:linear-gradient(135deg,var(--nv),var(--nv2));border-radius:14px;padding:1.2rem;margin-bottom:1.2rem;display:flex;align-items:center;gap:1rem;">
        <div style="width:52px;height:52px;background:linear-gradient(135deg,var(--p),var(--s));border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-size:1.4rem;font-weight:900;flex-shrink:0;">๐ค</div>
        <div>
          <div style="color:#fff;font-size:1rem;font-weight:800;" id="myOrdersName"></div>
          <div style="color:rgba(255,255,255,.55);font-size:.8rem;" id="myOrdersPhone"></div>
          <div style="color:rgba(255,255,255,.4);font-size:.72rem;margin-top:.2rem;">ุนุถู ููุฐ <span id="myOrdersJoin"></span></div>
          <div style="color:var(--ac);font-size:.78rem;font-weight:700;" id="myOrdersCount"></div>
        </div>
      </div>
      <div style="font-size:.92rem;font-weight:800;color:var(--nv);margin-bottom:.8rem;">๐๏ธ ุณุฌู ุงูุทูุจุงุช</div>
      <div id="myOrdersList"></div>
    </div>
  </div>
</div>

<!-- โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
     MAIN SCRIPT
     โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ -->
<script>
// โโ Firebase Init โโ
firebase.initializeApp(FIREBASE_CONFIG);
const fbDb = firebase.firestore();

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
//  DEFAULT CONFIG
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
const DEF = {
  meta:{ name:'ูุชุฌุฑู', logoLetter:'ู', logoText:'ูุชุฌุฑู', tagline:'ุชุณูู ุจุฐูู', logoImg:'' },
  colors:{ primary:'#7c3aed', secondary:'#2563eb', navy:'#0d1035', navy2:'#141847', accent:'#a78bfa', bg:'#f8f7ff', footerBg:'#0d1035' },
  hero:{ tag:'โจ ูุฌููุนุฉ 2025', l1:'ุชุณููู ุฃูุถู', l2:'ุงูููุชุฌุงุช ุงููุฎุชุงุฑุฉ', desc:'ุงูุชุดู ุชุดูููุฉ ุญุตุฑูุฉ ูู ุฃุฌูุฏ ุงูููุชุฌุงุช ุจุฃุณุนุงุฑ ุชูุงูุณูุฉ ูุน ุชูุตูู ุณุฑูุน ูุจุงุจ ููุฒูู', btn1:'ุชุณูู ุงูุขู', btn2:'ุงูุนุฑูุถ ุงูุฎุงุตุฉ', deco:'๐๏ธ', s1v:'+500', s1l:'ุนููู ุณุนูุฏ', s2v:'+80', s2l:'ููุชุฌ', s3v:'24h', s3l:'ุชูุตูู ุณุฑูุน' },
  announce:{ on:true, speed:28, items:['๐ ุนุฑุถ ูุคูุช: ุงุดุชุฑู ููุชุฌูู ูุงุญุตู ุนูู ุชูุตูู ูุฌุงูู','โ ุฏูุน ุขูู ุจุฌููุน ุงููุณุงุฆู ุงูุฅููุชุฑูููุฉ','๐ ุชูุตูู ุณุฑูุน ูุฌููุน ููุงุทู ุงูููููุฉ','๐ ุฃูุซุฑ ูู 500 ุนููู ุฑุงุถู'] },
  trust:[{icon:'๐',title:'ุฏูุน ุขูู',desc:'ุชุดููุฑ ูุงูู'},{icon:'โก',title:'ุชุณููู ููุฑู',desc:'ุจุนุฏ ุงูุฏูุน ูุจุงุดุฑุฉ'},{icon:'๐',title:'ุชูุตูู ุณุฑูุน',desc:'24-48 ุณุงุนุฉ'},{icon:'๐ง',title:'ุฏุนู 24/7',desc:'ูุญู ููุง ููุณุงุนุฏุชู'}],
  cats:[{label:'ุฅููุชุฑูููุงุช',count:'3 ููุชุฌุงุช',icon:'๐ฑ',color:'#312e81,#1e3a8a',key:'electronics'},{label:'ุฃุฒูุงุก',count:'2 ููุชุฌุงุช',icon:'๐',color:'#4c1d95,#5b21b6',key:'fashion'},{label:'ุฅูุณุณูุงุฑ',count:'2 ููุชุฌุงุช',icon:'๐',color:'#1e40af,#1d4ed8',key:'accessories'},{label:'ุงูููุฒู',count:'1 ููุชุฌ',icon:'๐ก',color:'#3730a3,#4338ca',key:'home'}],
  promo:{ on:true, tag:'โก ุนุฑุถ ูุญุฏูุฏ', title:'ุงุดุชุฑู 2 ูุงุญุตู ุนูู 1 ูุฌุงูุงู', desc:'ุนูู ุฌููุน ููุชุฌุงุช ุงูุฅูุณุณูุงุฑ', btn:'ุงุณุชูุฏ ูู ุงูุนุฑุถ', cat:'accessories', bg:'#0d1035,#7c3aed' },
  social:[{id:'whatsapp',label:'ูุงุชุณุงุจ',icon:'๐ฌ',url:'',on:true},{id:'twitter',label:'ุชููุชุฑ X',icon:'๐',url:'',on:true},{id:'instagram',label:'ุฅูุณุชุบุฑุงู',icon:'๐ธ',url:'',on:true},{id:'snapchat',label:'ุณูุงุจ',icon:'๐ป',url:'',on:false},{id:'tiktok',label:'ุชูู ุชูู',icon:'๐ต',url:'',on:false},{id:'youtube',label:'ููุชููุจ',icon:'โถ๏ธ',url:'',on:false}],
  mobileNav:[{icon:'๐',label:'ุงูุฑุฆูุณูุฉ',action:'home'},{icon:'๐',label:'ุงูุณูุฉ',action:'cart'},{icon:'๐ค',label:'ุญุณุงุจู',action:'login'},{icon:'๐ฅ',label:'ุงูุนุฑูุถ',action:'offers'}],
  nav:[{label:'ุงูุฑุฆูุณูุฉ',url:'#',cat:''},{label:'ุฅููุชุฑูููุงุช',url:'#',cat:'electronics'},{label:'ุฃุฒูุงุก',url:'#',cat:'fashion'},{label:'ุฅูุณุณูุงุฑ',url:'#',cat:'accessories'},{label:'ุงูููุฒู',url:'#',cat:'home'},{label:'๐ฅ ุนุฑูุถ',url:'#',cat:'sale',hl:true}],
  footer:{ desc:'ูุชุฌุฑ ุฅููุชุฑููู ูุชุฎุตุต ููุฏู ุฃูุถู ุงูููุชุฌุงุช ุจุฃุณุนุงุฑ ุชูุงูุณูุฉ.', c1t:'ุฑูุงุจุท ูููุฉ', c1:[{l:'ูู ูุญู',u:'#'},{l:'ุชูุงุตู ูุนูุง',u:'#'},{l:'ุณูุงุณุฉ ุงูุฎุตูุตูุฉ',u:'#'},{l:'ุณูุงุณุฉ ุงูุฅุฑุฌุงุน',u:'#'}], c2t:'ุงูุชุตูููุงุช', c2:[{l:'ุฅููุชุฑูููุงุช',u:'#'},{l:'ุฃุฒูุงุก',u:'#'},{l:'ุฅูุณุณูุงุฑ',u:'#'},{l:'ุงูููุฒู',u:'#'}], c3t:'ุชูุงุตู ูุนูุง', c3:[{l:'๐ฑ ูุงุชุณุงุจ',u:'#'},{l:'๐ง ุงูุจุฑูุฏ',u:'#'},{l:'๐ 9ุต - 10ู',u:'#'}], pay:['Visa','Mada','Apple Pay','STC Pay'], copy:'ยฉ 2025 ูุชุฌุฑู โ ุฌููุน ุงูุญููู ูุญููุธุฉ' },
  delivery:{ ownerWA:'966500000000', sendCust:true, sendOwner:true, msg:'๐ ุดูุฑุงู ูุทูุจู ูู {store}!\n\nุฑูู ุงูุทูุจ: {order}\nุงูููุชุฌ: {product}\n\n{codeBlock}\n\nโ๏ธ ูุฐุง ุงูููุฏ ุฎุงุต ุจู.' },
  store:{ freeShip:300, shipFee:25, currency:'ุฑ.ุณ', cod:true },
  reviews:[{name:'ุฃุญูุฏ ุงูุนุชูุจู',ini:'ุฃ',clr:'',date:'ููุฐ 3 ุฃูุงู',stars:5,text:'ููุชุฌ ููุชุงุฒ ุฌุฏุงู! ุงูููุฏ ูุตููู ููุฑุงู.',prod:'ุณูุงุนุงุช ูุงุณูููุฉ Pro'},{name:'ุณุงุฑุฉ ุงููุทูุฑู',ini:'ุณ',clr:'#0ea5e9,#2563eb',date:'ููุฐ ุฃุณุจูุน',stars:5,text:'ุชุฌุฑุจุฉ ููุชุงุฒุฉ!',prod:'ุณุงุนุฉ ุฐููุฉ Elite'},{name:'ูุญูุฏ ุงูุบุงูุฏู',ini:'ู',clr:'#7c3aed,#9333ea',date:'ููุฐ ุฃุณุจูุนูู',stars:4,text:'ุฎุฏูุฉ ุฑุงุฆุนุฉ ูุชุณููู ุณุฑูุน.',prod:'ุนุทุฑ Noir Luxe'}]
};

function loadCfg(){
  try{const s=localStorage.getItem('storeConfig');if(s){const p=JSON.parse(s);const o=JSON.parse(JSON.stringify(DEF));for(const k in p){if(p[k]!==null&&typeof p[k]==='object'&&!Array.isArray(p[k]))o[k]=Object.assign({},DEF[k]||{},p[k]);else o[k]=p[k];}return o;}}catch(e){}
  return JSON.parse(JSON.stringify(DEF));
}
let C=loadCfg();

(function applyColors(){
  const r=document.documentElement.style,col=C.colors;
  r.setProperty('--p',col.primary);r.setProperty('--s',col.secondary);
  r.setProperty('--nv',col.navy);r.setProperty('--nv2',col.navy2||col.navy);
  r.setProperty('--ac',col.accent);r.setProperty('--bg',col.bg);
})();

// โโโโโโโโ PRODUCTS โโโโโโโโ
let products=[];
try{const sp=localStorage.getItem('storeProducts');if(sp)products=JSON.parse(sp);}catch(e){}
if(!products.length)products=[
  {id:1,name:'ุณูุงุนุงุช ูุงุณูููุฉ Pro',price:249,oldPrice:320,desc:'ุณูุงุนุงุช ุจููุชูุซ ุจุฌูุฏุฉ ุตูุช ุงุณุชุซูุงุฆูุฉ.',emoji:'๐ง',cat:'electronics',badge:'sale',rating:4.8,rCount:124,featured:true,active:true,codeType:'code',codes:[{val:'AUDIO-X71K',used:false},{val:'AUDIO-M89P',used:false}]},
  {id:2,name:'ุณุงุนุฉ ุฐููุฉ Elite',price:599,oldPrice:750,desc:'ุณุงุนุฉ ุฐููุฉ ูุน ูุชุงุจุนุฉ ุตุญูุฉ ุดุงููุฉ.',emoji:'โ',cat:'electronics',badge:'hot',rating:4.9,rCount:89,featured:true,active:true,codeType:'account',codes:[{user:'elite@watch.com',pass:'Watch@2025',note:'ุฑูุฌู SA',used:false}]},
  {id:3,name:'ุญููุจุฉ ุฌูุฏ ูุงุฎุฑุฉ',price:380,desc:'ุญููุจุฉ ูุฏ ูู ุงูุฌูุฏ ุงูุทุจูุนู.',emoji:'๐',cat:'fashion',badge:'new',rating:4.7,rCount:56,featured:false,active:true,codeType:'none',codes:[]},
  {id:4,name:'ุนุทุฑ Noir Luxe',price:320,oldPrice:400,desc:'ุนุทุฑ ูุงุฎุฑ ุจุชุฑููุจุฉ ุดุฑููุฉ.',emoji:'๐น',cat:'accessories',badge:'sale',rating:4.6,rCount:78,featured:true,active:true,codeType:'code',codes:[{val:'NOIR-AA1',used:false},{val:'NOIR-BB2',used:false}]},
  {id:5,name:'ูุงุจุชูุจ ุฅุจุฏุงุนู S14',price:3200,desc:'ูุงุจุชูุจ ุฎููู ุจูุนุงูุฌ ููู.',emoji:'๐ป',cat:'electronics',badge:'new',rating:4.9,rCount:34,featured:false,active:true,codeType:'none',codes:[]},
  {id:6,name:'ุฎุงุชู ูุถุฉ ูููุฉ',price:175,desc:'ุฎุงุชู ูุถุฉ 925 ุจุชุตููู ุฃููู.',emoji:'๐',cat:'accessories',badge:'',rating:4.3,rCount:41,featured:false,active:true,codeType:'none',codes:[]},
  {id:7,name:'ุญุฐุงุก ุฑูุงุถู Aero',price:290,oldPrice:370,desc:'ุญุฐุงุก ุฑูุงุถู ูุฑูุญ ููุฌุฑู.',emoji:'๐',cat:'fashion',badge:'sale',rating:4.5,rCount:67,featured:true,active:true,codeType:'none',codes:[]},
  {id:8,name:'ุฅุทุงุฑ ุฏูููุฑ ุฐูุจู',price:145,desc:'ุฅุทุงุฑ ูุงุฎุฑ ูููุฒูู.',emoji:'๐ผ๏ธ',cat:'home',badge:'',rating:4.4,rCount:22,featured:false,active:true,codeType:'none',codes:[]}
];

let cart=[], isLoggedIn=false, currentCat='all', currentPd=null, pdQty=1;
let currentUser=null; // {uid, email, name, joinDate}
let _confirmResult=null;
let _authMode='login'; // 'login' | 'register'

// โโ ุชุจุฏูู ุจูู ุงูุฏุฎูู ูุงูุชุณุฌูู โโ
function switchAuthTab(mode){
  _authMode=mode;
  const tLogin=document.getElementById('tab-login');
  const tReg=document.getElementById('tab-register');
  const nameRow=document.getElementById('ls1-name-row');
  const title=document.getElementById('loginSheetTitle');
  const act='background:linear-gradient(135deg,var(--p),var(--s));color:#fff;';
  const inact='background:transparent;color:var(--gr);';
  if(mode==='login'){
    tLogin.style.cssText=tLogin.style.cssText.replace(/background:[^;]+;color:[^;]+;/,'')+act;
    tReg.style.cssText=tReg.style.cssText.replace(/background:[^;]+;color:[^;]+;/,'')+inact;
    nameRow.style.display='none';
    title.textContent='ุชุณุฌูู ุงูุฏุฎูู ๐';
  }else{
    tLogin.style.cssText=tLogin.style.cssText.replace(/background:[^;]+;color:[^;]+;/,'')+inact;
    tReg.style.cssText=tReg.style.cssText.replace(/background:[^;]+;color:[^;]+;/,'')+act;
    nameRow.style.display='block';
    title.textContent='ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ โจ';
  }
}

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
//  ๐ฅ FIRESTORE โ ูุณุชูุนุงุช ูุญุธูุฉ
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
function startStoreListeners(){
  // ูุณุชูุน ุงูุฅุนุฏุงุฏุงุช โ ุฃู ุชุบููุฑ ูู ุงูุฏุงุด ููุญุฏูุซ ุงููุชุฌุฑ ููุฑุงู
  fbDb.collection('storeSettings').doc('config').onSnapshot(doc=>{
    if(!doc.exists)return;
    const data=doc.data();
    const out=JSON.parse(JSON.stringify(DEF));
    for(const k in data){if(data[k]!==null&&typeof data[k]==='object'&&!Array.isArray(data[k]))out[k]=Object.assign({},DEF[k]||{},data[k]);else out[k]=data[k];}
    C=out;
    try{localStorage.setItem('storeConfig',JSON.stringify(C));}catch(e){}
    // ุชุทุจูู ุงูุฃููุงู ูุฅุนุงุฏุฉ ุจูุงุก ุงููุชุฌุฑ
    const r=document.documentElement.style,col=C.colors;
    r.setProperty('--p',col.primary);r.setProperty('--s',col.secondary);
    r.setProperty('--nv',col.navy);r.setProperty('--nv2',col.navy2||col.navy);
    r.setProperty('--ac',col.accent);r.setProperty('--bg',col.bg);
    buildAll();updateLoginBtn();
  },e=>console.warn('store config listener:',e));

  // ูุณุชูุน ุงูููุชุฌุงุช โ ุชุญุฏูุซ ูุญุธู ุนูุฏ ุฅุถุงูุฉ/ุญุฐู/ุชุนุฏูู ููุชุฌ ุฃู ููุฏ
  fbDb.collection('storeData').doc('products').onSnapshot(doc=>{
    if(!doc.exists||!doc.data().list)return;
    products=doc.data().list;
    try{localStorage.setItem('storeProducts',JSON.stringify(products));}catch(e){}
    refreshProds();
  },e=>console.warn('store products listener:',e));
}

// ุชุญููู ุฃููู ูู Firestore ูุจู ุงูุจูุงุก
async function initStore(){
  try{
    const [cfgDoc,prodsDoc]=await Promise.all([
      fbDb.collection('storeSettings').doc('config').get(),
      fbDb.collection('storeData').doc('products').get()
    ]);
    if(cfgDoc.exists){
      const data=cfgDoc.data();
      const out=JSON.parse(JSON.stringify(DEF));
      for(const k in data){if(data[k]!==null&&typeof data[k]==='object'&&!Array.isArray(data[k]))out[k]=Object.assign({},DEF[k]||{},data[k]);else out[k]=data[k];}
      C=out;
      try{localStorage.setItem('storeConfig',JSON.stringify(C));}catch(e){}
      const r=document.documentElement.style,col=C.colors;
      r.setProperty('--p',col.primary);r.setProperty('--s',col.secondary);
      r.setProperty('--nv',col.navy);r.setProperty('--nv2',col.navy2||col.navy);
      r.setProperty('--ac',col.accent);r.setProperty('--bg',col.bg);
    }
    if(prodsDoc.exists&&prodsDoc.data().list&&prodsDoc.data().list.length){
      products=prodsDoc.data().list;
      try{localStorage.setItem('storeProducts',JSON.stringify(products));}catch(e){}
    }
  }catch(e){console.warn('initStore:',e);}
  buildAll();updateLoginBtn();
  startStoreListeners(); // ุจุฏุก ุงููุณุชูุนุงุช ุงููุญุธูุฉ
}



// ุฑูู ุงูุทูุจ ุงูุชุณูุณูู ูู Firestore
async function getNextOrderNum(){
  try{
    const ref=fbDb.collection('meta').doc('orderCounter');
    const num=await fbDb.runTransaction(async tx=>{
      const d=await tx.get(ref);
      const next=(d.exists?d.data().value:0)+1;
      tx.set(ref,{value:next});
      return next;
    });
    return '#'+String(num).padStart(4,'0');
  }catch(e){
    // Fallback offline
    const n=(parseInt(localStorage.getItem('orderCounter')||'0')+1);
    localStorage.setItem('orderCounter',n);
    return '#'+String(n).padStart(4,'0');
  }
}

// ุญูุธ/ุชุญุฏูุซ ุงูุนููู ูู Firestore
async function fbUpsertCustomer(uid,email,name,joinDate){
  try{
    const ref=fbDb.collection('customers').doc(uid);
    const doc=await ref.get();
    if(!doc.exists){
      await ref.set({uid,email:email||'',name:name||'',joinDate:joinDate||new Date().toLocaleDateString('ar-SA'),orders:[],createdAt:firebase.firestore.FieldValue.serverTimestamp()});
    } else {
      const upd={};
      if(name&&!doc.data().name) upd.name=name;
      if(email&&!doc.data().email) upd.email=email;
      if(Object.keys(upd).length) await ref.update(upd);
    }
    return (await ref.get()).data();
  }catch(e){return null;}
}

// ุญูุธ ุทูุจ ูู Firestore
async function fbSaveOrder(uid,order){
  try{
    await fbDb.collection('customers').doc(uid).update({orders:firebase.firestore.FieldValue.arrayUnion(order)});
    await fbDb.collection('orders').doc(order.id.replace('#','')).set({...order,uid,savedAt:firebase.firestore.FieldValue.serverTimestamp()});
  }catch(e){console.warn('fbSaveOrder',e);}
}

// ุฌูุจ ุทูุจุงุช ุงูุนููู
async function fbGetOrders(uid){
  try{const d=await fbDb.collection('customers').doc(uid).get();return d.exists?(d.data().orders||[]):[];}catch(e){return[];}
}

// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
//  ๐ ูุธุงู OTP ุนุจุฑ ุงูุจุฑูุฏ ุงูุฅููุชุฑููู (EmailJS)
// โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

let _otpTimerInt = null;   // ูุคูุช ุงูุนุฏ ุงูุชูุงุฒูู
let _otpExpiry   = 0;      // ููุช ุงูุชูุงุก ุตูุงุญูุฉ ุงูุฑูุฒ

/* โโ ุชูููุฏ UID ูู ุงูุฅูููู (ููู Firestore) โโ */
function emailToUid(email){
  // ูุซุงู: user@gmail.com โ user_gmail_com
  return 'u_'+email.toLowerCase().replace(/[^a-z0-9]/g,'_');
}

/* โโ ุฅุฑุณุงู ุฑูุฒ OTP โโ */
async function doSendOTP(isResend=false){
  const email = document.getElementById('emailF').value.trim();

  // ุงูุชุญูู ูู ุตุญุฉ ุงูุฅูููู (ูุฌุจ ุฃู ูููู ุจุตูุบุฉ xxx@xxx.xxx)
  const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]{2,}$/;
  if(!email || !emailRegex.test(email)){
    showToast('โ ูุฑุฌู ุฅุฏุฎุงู ุจุฑูุฏ ุฅููุชุฑููู ุตุญูุญ ูุซู: example@gmail.com');
    document.getElementById('emailF').focus();
    return;
  }

  if(_authMode==='register'){
    const nm=document.getElementById('regName').value.trim();
    if(!nm){showToast('ูุฑุฌู ุฅุฏุฎุงู ุงุณูู ุฃููุงู');document.getElementById('regName').focus();return;}
    // ุงูุชุญูู ูู ุงูุงุณู ุงูุซูุงุซู (3 ูููุงุช ุนูู ุงูุฃูู)
    const nameParts = nm.split(/\s+/).filter(Boolean);
    if(nameParts.length < 3){
      showToast('โ ูุฑุฌู ุฅุฏุฎุงู ุงูุงุณู ุงูุซูุงุซู ูุงููุงู');
      document.getElementById('regName').focus();
      return;
    }
  }

  if(_authMode==='login' && !isResend){
    // ุงูุชุญูู ูู ูุฌูุฏ ุงูุญุณุงุจ ูุจู ุฅุฑุณุงู OTP
    const uid = emailToUid(email);
    try{
      const doc = await fbDb.collection('customers').doc(uid).get();
      if(!doc.exists){
        // ูุง ููุฌุฏ ุญุณุงุจ โ ุนุฑุถ ุฑุณุงูุฉ ูุชุญููู ูุฅูุดุงุก ุญุณุงุจ
        showToast('โ ูุง ููุฌุฏ ุญุณุงุจ ุจูุฐุง ุงูุจุฑูุฏ');
        // ุนุฑุถ ุฑุณุงูุฉ ุฏุงุฎู ุงูุดูุช
        const welcome = document.getElementById('ls1-welcome');
        if(welcome){
          welcome.style.display='block';
          welcome.style.background='rgba(239,68,68,.08)';
          welcome.style.borderColor='rgba(239,68,68,.2)';
          welcome.style.color='var(--re)';
          welcome.innerHTML='โ ูุง ููุฌุฏ ูุฏูู ุญุณุงุจ โ ูุฑุฌู ุฅูุดุงุก ุญุณุงุจ ุฃููุงู <span style="color:var(--p);cursor:pointer;font-weight:800;text-decoration:underline;" onclick="switchAuthTab(\'register\')">ุฅูุดุงุก ุญุณุงุจ</span>';
        }
        return;
      }
    }catch(e){ /* ุชุฌุงูู ุฎุทุฃ ุงูุงุชุตุงู ูุฃููู */ }
  }

  const btn=document.getElementById('sendOtpBtn');
  btn.disabled=true;
  btn.textContent='โณ ุฌุงุฑู ุงูุฅุฑุณุงู...';

  // ุชูููุฏ ุฑูุฒ ุนุดูุงุฆู 6 ุฃุฑูุงู
  const code = String(Math.floor(100000 + Math.random() * 900000));
  const expiry = Date.now() + 10 * 60 * 1000; // 10 ุฏูุงุฆู

  try{
    // ุญูุธ ุงูุฑูุฒ ูู Firestore ูุน ููุช ุงูุชูุงุก ุงูุตูุงุญูุฉ
    await fbDb.collection('otpCodes').doc(emailToUid(email)).set({
      code,
      expiry,
      email,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    // ุฅุฑุณุงู ุงูุฑูุฒ ุนุจุฑ EmailJS
    await emailjs.send(
      EMAILJS_CONFIG.serviceId,
      EMAILJS_CONFIG.templateId,
      {
        to_email : email,
        otp_code : code,
        store_name: C?.meta?.name || 'ูุชุฌุฑู',
        expiry_min: '10'
      }
    );

    // ุงูุงูุชูุงู ููุฎุทูุฉ ุงูุซุงููุฉ
    document.getElementById('ls1').style.display='none';
    document.getElementById('ls2').style.display='block';
    document.getElementById('ls2-email').textContent=email;
    document.querySelectorAll('.otp-box').forEach(b=>{b.value='';});
    setTimeout(()=>document.querySelectorAll('.otp-box')[0]?.focus(),100);

    // ุจุฏุก ุงูุนุฏุงุฏ ุงูุชูุงุฒูู
    _otpExpiry=expiry;
    startOtpTimer();

    showToast(isResend ? 'โ ุชู ุฅุนุงุฏุฉ ุฅุฑุณุงู ุงูุฑูุฒ' : 'โ ุชู ุฅุฑุณุงู ุฑูุฒ ุงูุชุญูู ุฅูู '+email);

  }catch(e){
    console.error('OTP send error:',e);
    showToast('โ ูุดู ุงูุฅุฑุณุงู โ ุชุญูู ูู ุฅุนุฏุงุฏุงุช EmailJS');
  }finally{
    btn.disabled=false;
    btn.textContent='ุฅุฑุณุงู ุฑูุฒ ุงูุชุญูู ๐ง';
  }
}

/* โโ ุชุฃููุฏ ุฑูุฒ OTP โโ */
async function doVerifyOTP(){
  const email = document.getElementById('emailF').value.trim();
  const entered = [...document.querySelectorAll('.otp-box')].map(e=>e.value).join('');

  if(entered.length < 6){showToast('ุฃุฏุฎู ุงูุฑูุฒ ุงูููููู ูู 6 ุฃุฑูุงู');return;}

  const btn=document.getElementById('verifyOtpBtn');
  btn.disabled=true; btn.textContent='โณ ุฌุงุฑู ุงูุชุญูู...';

  try{
    const uid=emailToUid(email);
    const doc=await fbDb.collection('otpCodes').doc(uid).get();

    if(!doc.exists){showToast('โ ุงูุฑูุฒ ุบูุฑ ููุฌูุฏ โ ุฃุฑุณูู ูุฌุฏุฏุงู');btn.disabled=false;btn.textContent='ุชุฃููุฏ ุงูุฑูุฒ โ';return;}

    const {code, expiry} = doc.data();

    if(Date.now() > expiry){
      showToast('โ ุงูุชูุช ุตูุงุญูุฉ ุงูุฑูุฒ โ ุฃุฑุณูู ูุฌุฏุฏุงู');
      stopOtpTimer();
      btn.disabled=false; btn.textContent='ุชุฃููุฏ ุงูุฑูุฒ โ';
      return;
    }

    if(entered !== code){
      showToast('โ ุงูุฑูุฒ ุบูุฑ ุตุญูุญ');
      // ุชูููู ุงูุตูุงุฏูู ุจุงูุฃุญูุฑ
      document.querySelectorAll('.otp-box').forEach(b=>{b.style.borderColor='var(--re)';});
      setTimeout(()=>document.querySelectorAll('.otp-box').forEach(b=>{b.style.borderColor='';}),1200);
      btn.disabled=false; btn.textContent='ุชุฃููุฏ ุงูุฑูุฒ โ';
      return;
    }

    // โ ุงูุฑูุฒ ุตุญูุญ โ ุญุฐูู ูู Firestore
    await fbDb.collection('otpCodes').doc(uid).delete().catch(()=>{});
    stopOtpTimer();

    // ุฅูุดุงุก/ุฌูุจ ุจูุงูุงุช ุงููุณุชุฎุฏู
    const nm = _authMode==='register' ? (document.getElementById('regName')?.value?.trim()||'') : '';
    const joinDate = new Date().toLocaleDateString('ar-SA');
    const cdata = await fbUpsertCustomer(uid, email, nm, joinDate);

    currentUser = {uid, email, name: cdata?.name||nm, joinDate: cdata?.joinDate||joinDate};
    isLoggedIn = true;
    updateLoginBtn();

    // ุญูุธ ุงูุฌูุณุฉ ูู localStorage
    try{localStorage.setItem('storeSession',JSON.stringify(currentUser));}catch(e){}

    // ุนุฑุถ ุดุงุดุฉ ุงููุฌุงุญ
    document.getElementById('ls2').style.display='none';
    document.getElementById('ls3').style.display='block';
    const isNew = _authMode==='register'||!cdata?.name;
    document.getElementById('ls3-greeting').textContent = isNew ? 'ุชู ุฅูุดุงุก ุญุณุงุจู! ๐' : 'ุฃููุงู ุจุนูุฏุชู! ๐';
    document.getElementById('ls3-name').textContent = currentUser.name||email;
    document.getElementById('ls3-phone').textContent = email;
    setTimeout(()=>closeSheet('loginSheet'),2000);
    showToast((isNew?'ูุฑุญุจุงู ุจู ':'ุฃููุงู ')+(currentUser.name||email)+'! โ');

  }catch(e){
    console.error('OTP verify error:',e);
    showToast('โ ุญุฏุซ ุฎุทุฃุ ุญุงูู ูุฌุฏุฏุงู');
  }finally{
    btn.disabled=false; btn.textContent='ุชุฃููุฏ ุงูุฑูุฒ โ';
  }
}

/* โโ ุงูุชุนุงูู ูุน ุตูุงุฏูู OTP โโ */
function otpN(el,i){
  el.value=el.value.replace(/[^0-9]/g,'');
  if(el.value.length===1){
    const boxes=document.querySelectorAll('.otp-box');
    if(i<5) boxes[i+1].focus();
    else doVerifyOTP();
  }
}
function otpBack(e,el,i){
  if(e.key==='Backspace'&&!el.value&&i>0)
    document.querySelectorAll('.otp-box')[i-1].focus();
}

/* โโ ุงูุนุฏุงุฏ ุงูุชูุงุฒูู โโ */
function startOtpTimer(){
  stopOtpTimer();
  function tick(){
    const rem=Math.max(0,Math.ceil((_otpExpiry-Date.now())/1000));
    const m=String(Math.floor(rem/60)).padStart(2,'0');
    const s=String(rem%60).padStart(2,'0');
    const el=document.getElementById('otpTimer');
    if(el){
      el.textContent=`${m}:${s}`;
      el.style.color=rem<=60?'var(--re)':'var(--p)';
    }
    if(rem<=0){stopOtpTimer();showToast('โฐ ุงูุชูุช ุตูุงุญูุฉ ุงูุฑูุฒ');}
  }
  tick();
  _otpTimerInt=setInterval(tick,1000);
}
function stopOtpTimer(){clearInterval(_otpTimerInt);_otpTimerInt=null;}

/* โโ ุงูุนูุฏุฉ ูุฅุฏุฎุงู ุงูุฅูููู โโ */
function backToEmail(){
  stopOtpTimer();
  document.getElementById('ls2').style.display='none';
  document.getElementById('ls1').style.display='block';
  document.querySelectorAll('.otp-box').forEach(b=>b.value='');
}

/* โโ ุชุณุฌูู ุงูุฎุฑูุฌ โโ */
function doLogout(){
  isLoggedIn=false; currentUser=null; _authMode='login';
  try{localStorage.removeItem('storeSession');}catch(e){}
  updateLoginBtn();
  backToEmail();
  document.getElementById('ls1').style.display='block';
  ['ls2','ls3'].forEach(id=>document.getElementById(id).style.display='none');
  document.getElementById('emailF').value='';
  try{document.getElementById('regName').value='';}catch(e){}
  document.getElementById('ls1-welcome').style.display='none';
  switchAuthTab('login');
  showToast('ุชู ุชุณุฌูู ุงูุฎุฑูุฌ');
}

/* โโ ุงุณุชุนุงุฏุฉ ุงูุฌูุณุฉ ุชููุงุฆูุงู ูู localStorage โโ */
(async function restoreSession(){
  try{
    const s=localStorage.getItem('storeSession');
    if(!s)return;
    const saved=JSON.parse(s);
    if(!saved?.uid||!saved?.email)return;
    // ุงูุชุญูู ูู ูุฌูุฏู ูู Firestore
    const doc=await fbDb.collection('customers').doc(saved.uid).get();
    if(doc.exists){
      const d=doc.data();
      currentUser={uid:saved.uid,email:saved.email,name:d.name||saved.name||'',joinDate:d.joinDate||saved.joinDate||''};
      isLoggedIn=true;
      updateLoginBtn();
      const w=document.getElementById('ls1-welcome');
      if(w&&currentUser.name){w.style.display='block';w.textContent='ุฃููุงู ุจุนูุฏุชู '+currentUser.name+' ๐';}
    }else{
      localStorage.removeItem('storeSession');
    }
  }catch(e){}
})();

// โโโโโโโโ BUILD SECTIONS โโโโโโโโ
function buildAll(){
  document.getElementById('pgTitle').textContent=C.meta.name;
  buildAnnounce();buildLogo();buildNav();buildHActions();
  buildHero();buildTrust();buildCats();buildPromo();
  buildMobileNav();buildFooter();buildReviews();refreshProds();
  updateDarkBtnIcons();
}

function buildAnnounce(){
  const bar=document.getElementById('announceBar');
  if(!C.announce.on){bar.style.display='none';return;}
  bar.style.display='flex';
  bar.style.background=`linear-gradient(90deg,${C.colors.navy},${C.colors.primary},${C.colors.secondary},${C.colors.primary},${C.colors.navy})`;
  const items=[...C.announce.items,...C.announce.items];
  document.getElementById('atrack').innerHTML=items.map(t=>`<div class="ait">${t}</div>`).join('');
  document.getElementById('atrack').style.animationDuration=(C.announce.speed||28)+'s';
}

function buildLogo(){
  const el=document.getElementById('storeLogo');
  const ico=C.meta.logoImg
    ?`<div class="logo-icon"><img src="${C.meta.logoImg}" alt="logo"></div>`
    :`<div class="logo-icon" style="background:linear-gradient(135deg,${C.colors.primary},${C.colors.secondary})">${C.meta.logoLetter}</div>`;
  el.innerHTML=ico+`<div><div class="logo-name">${C.meta.logoText}</div>${C.meta.tagline?`<div class="logo-tag">${C.meta.tagline}</div>`:''}</div>`;
}

function buildNav(){
  document.getElementById('navLinks').innerHTML=C.nav.map(n=>`
    <li><a href="${n.url||'#'}" ${n.cat?`onclick="openCatPage('${n.cat}');return false;"`:''} style="${n.hl?'color:var(--re);font-weight:800;':''}">${n.label}</a></li>`).join('');
}

function buildHActions(){
  document.getElementById('hactions').innerHTML=`
    <button class="hbtn" id="darkModeBtn" onclick="toggleDark()" title="ุงููุถุน ุงูุฏุงูู" style="font-size:1rem;padding:.45rem .6rem;">๐</button>
    <button class="hbtn" id="loginBtn" onclick="isLoggedIn?openMyOrders():openSheet('loginSheet')">๐ ุฏุฎูู</button>
    <button class="hbtn primary" onclick="openSheet('cartSheet')">๐ ุงูุณูุฉ <span class="cc" id="cartCount">0</span></button>`;
}
function updateLoginBtn(){
  const btn=document.getElementById('loginBtn');
  if(!btn)return;
  btn.innerHTML=isLoggedIn&&currentUser?`๐ค ${currentUser.name||currentUser.email}`:'๐ ุฏุฎูู';
  btn.onclick=isLoggedIn?openMyOrders:()=>openSheet('loginSheet');
}

function buildHero(){
  const h=C.hero,col=C.colors;
  document.getElementById('heroSection').style.background=`linear-gradient(135deg,${col.navy} 0%,${col.navy2||col.navy} 40%,#1e1065 100%)`;
  ['tag','l1','l2','desc'].forEach(k=>document.getElementById('hero'+k.charAt(0).toUpperCase()+k.slice(1)).textContent=h[k]);
  document.getElementById('hBtn1').textContent=h.btn1;
  document.getElementById('hBtn2').textContent=h.btn2;
  document.getElementById('heroDeco').textContent=h.deco||'๐๏ธ';
  document.getElementById('heroStats').innerHTML=`
    <div><div class="hsn">${h.s1v}</div><div class="hsl">${h.s1l}</div></div>
    <div><div class="hsn">${h.s2v}</div><div class="hsl">${h.s2l}</div></div>
    <div><div class="hsn">${h.s3v}</div><div class="hsl">${h.s3l}</div></div>`;
}

function buildTrust(){
  document.getElementById('trustBar').innerHTML=C.trust.map((t,i)=>
    `${i?'<div class="tdv"></div>':''}<div class="ti"><div class="ti-ic">${t.icon}</div><div><div class="ti-ttl">${t.title}</div><div class="ti-sub">${t.desc}</div></div></div>`
  ).join('');
}

function buildCats(){
  document.getElementById('catsGrid').innerHTML=C.cats.map(c=>`
    <div class="ccard" style="background:linear-gradient(135deg,${c.color})" onclick="openCatPage('${c.key}')">
      <div class="cbg">${c.icon}</div><div class="cov"></div>
      <div class="clbl">${c.label}<br><span class="ccount">${c.count}</span></div>
    </div>`).join('');
}

function buildPromo(){
  const p=C.promo;
  if(!p.on){document.getElementById('promoWrap').style.display='none';return;}
  document.getElementById('promoWrap').style.display='block';
  document.getElementById('promoBnr').style.background=`linear-gradient(135deg,${p.bg||C.colors.navy+','+C.colors.primary})`;
  document.getElementById('promoTag').textContent=p.tag;
  document.getElementById('promoTitle').textContent=p.title;
  document.getElementById('promoDesc').textContent=p.desc;
  const btn=document.getElementById('promoBtn');
  btn.textContent=p.btn;btn.style.color=C.colors.primary;
  btn.onclick=()=>openCatPage(p.cat||'');
}

function buildMobileNav(){
  document.getElementById('mnItems').innerHTML=C.mobileNav.map((item,i)=>`
    <button class="mn-item ${i===0?'act':''}" onclick="handleMN('${item.action}')">
      <span class="mn-ic">${item.icon}</span>${item.label}
    </button>`).join('');
}
function handleMN(a){
  ({home:()=>scrollTo({top:0,behavior:'smooth'}),cart:()=>openSheet('cartSheet'),
    login:()=>isLoggedIn?openMyOrders():openSheet('loginSheet'),
    offers:()=>openCatPage('sale'),
    whatsapp:()=>{const w=C.social.find(s=>s.id==='whatsapp');if(w&&w.url)window.open(w.url,'_blank');},
    dashboard:()=>location.href='dashboard.html'
  }[a]||{home:()=>scrollTo({top:0,behavior:'smooth'})}.home)();
}

function buildFooter(){
  const f=C.footer,col=C.colors;
  document.getElementById('siteFooter').style.background=col.footerBg||col.navy;
  const socs=C.social.filter(s=>s.on&&s.url).map(s=>`<a class="soc" href="${s.url}" target="_blank">${s.icon}</a>`).join('');
  document.getElementById('footerTop').innerHTML=`
    <div>
      ${C.meta.logoImg
        ?`<div class="fbl"><div class="fbi"><img src="${C.meta.logoImg}" alt></div><div class="fbn">${C.meta.logoText}</div></div>`
        :`<div class="fbl"><div class="fbi" style="background:linear-gradient(135deg,${col.primary},${col.secondary})">${C.meta.logoLetter}</div><div class="fbn">${C.meta.logoText}</div></div>`}
      <p class="fbd">${f.desc}</p><div class="socs">${socs}</div>
    </div>
    <div><div class="fct">${f.c1t}</div><ul class="fls">${f.c1.map(l=>`<li><a href="${l.u}">${l.l}</a></li>`).join('')}</ul></div>
    <div><div class="fct">${f.c2t}</div><ul class="fls">${f.c2.map(l=>`<li><a href="${l.u}">${l.l}</a></li>`).join('')}</ul></div>
    <div><div class="fct">${f.c3t}</div><ul class="fls">${f.c3.map(l=>`<li><a href="${l.u}">${l.l}</a></li>`).join('')}</ul></div>`;
  document.getElementById('footerBot').innerHTML=`
    <div class="ftcp">${f.copy}</div>
    <div class="paybdgs">${(f.pay||[]).map(b=>`<div class="paybdg">${b}</div>`).join('')}</div>`;
}

function buildReviews(){
  document.getElementById('reviewsGrid').innerHTML=C.reviews.map(r=>`
    <div class="rc2">
      <div class="rh"><div class="rav" style="${r.clr?`background:linear-gradient(135deg,${r.clr})`:`background:linear-gradient(135deg,${C.colors.primary},${C.colors.secondary})`}">${r.ini}</div>
      <div><div class="rnm">${r.name}</div><div class="rdt">${r.date}</div></div></div>
      <div class="rst">${'โ'.repeat(r.stars)}${'โ'.repeat(5-r.stars)}</div>
      <div class="rtx">${r.text}</div><div class="rprd">${r.prod}</div>
    </div>`).join('');
}

// โโโโโโโโ PRODUCTS โโโโโโโโ
function renderProds(list,gid){
  const g=document.getElementById(gid),cur=C.store.currency||'ุฑ.ุณ';
  if(!list||!list.length){g.innerHTML='<div style="color:var(--gr);grid-column:1/-1;text-align:center;padding:2rem;">ูุง ุชูุฌุฏ ููุชุฌุงุช</div>';return;}
  g.innerHTML=list.filter(p=>p.active).map(p=>{
    const avail=p.codeType!=='none'?p.codes.filter(c=>!c.used).length:null;
    const sold=avail===0;
    const disc=p.oldPrice?Math.round((1-p.price/p.oldPrice)*100):0;
    return `<div class="pc" onclick="${sold?'':'openProd('+p.id+')'}" style="${sold?'opacity:.65;':''}">
      <div class="pth">
        ${p.badge==='new'?'<span class="pbdg bnn">ุฌุฏูุฏ</span>':p.badge==='sale'?'<span class="pbdg bns">-'+disc+'%</span>':p.badge==='hot'?'<span class="pbdg bnh">๐ฅ ุงูุฃูุซุฑ</span>':''}
        <button class="wbtn" onclick="event.stopPropagation();showToast('โค๏ธ ุชูุช ุงูุฅุถุงูุฉ ููููุถูุฉ')">โก</button>
        ${p.emoji}
        ${p.codeType!=='none'?`<div class="dcbdg">${p.codeType==='account'?'๐ค':'๐'} ${avail} ูุชุงุญ</div>`:''}
      </div>
      <div class="pb">
        <div class="pnm">${p.name}</div>
        <div class="prt"><span class="sts">${'โ'.repeat(Math.floor(p.rating))}${'โ'.repeat(5-Math.floor(p.rating))}</span><span class="rc">(${p.rCount})</span></div>
        <div class="ppr">
          <div>
            <div class="pp">${p.price} ${cur}</div>
            ${p.oldPrice?`<div class="po">${p.oldPrice} ${cur}</div>`:''}
          </div>
          ${sold?'<span style="font-size:.75rem;color:var(--re);font-weight:700;">ููุฏ</span>':`<button class="abtn" onclick="event.stopPropagation();quickAdd(${p.id})">+</button>`}
        </div>
      </div>
    </div>`;
  }).join('');
}
function refreshProds(){
  const list=currentCat==='all'?products:products.filter(p=>p.cat===currentCat);
  renderProds(list,'prodsGrid');
  renderProds(products.filter(p=>p.featured),'featGrid');
}
function filterCat(cat){
  currentCat=cat;
  const found=C.cats.find(c=>c.key===cat);
  document.getElementById('prodsTitle').textContent=found?found.label:'ุงูููุชุฌุงุช';
  document.getElementById('prodsec').scrollIntoView({behavior:'smooth'});
  refreshProds();
}
function showAll(){currentCat='all';document.getElementById('prodsTitle').textContent='ุฌููุน ุงูููุชุฌุงุช';refreshProds();}
function liveSearch(){
  const q=document.getElementById('searchInp').value.trim().toLowerCase();
  if(!q){refreshProds();return;}
  renderProds(products.filter(p=>p.name.toLowerCase().includes(q)||p.desc.toLowerCase().includes(q)),'prodsGrid');
}

// โโโโโโโโ SHEETS โโโโโโโโ
function openSheet(id){if(id==='cartSheet')renderCart();document.getElementById(id).classList.add('open');}
function closeSheet(id){document.getElementById(id).classList.remove('open');}
function bgClose(e,id){if(e.target.id===id)closeSheet(id);}

// โโโโโโโโ DARK MODE โโโโโโโโ
let _dark=false;
try{_dark=localStorage.getItem('darkMode')==='1';}catch(e){}
if(_dark)document.documentElement.classList.add('dark');
function toggleDark(){
  _dark=!_dark;
  document.documentElement.classList.toggle('dark',_dark);
  try{localStorage.setItem('darkMode',_dark?'1':'0');}catch(e){}
  const btns=[document.getElementById('darkBtn'),document.getElementById('darkModeBtn')];
  btns.forEach(b=>{if(b)b.textContent=_dark?'โ๏ธ':'๐';});
}
// ุชุทุจูู ุฃููููุฉ ุงูุฏุงูู ุนูุฏ ุงูุจูุงุก
function updateDarkBtnIcons(){
  const btns=[document.getElementById('darkBtn'),document.getElementById('darkModeBtn')];
  btns.forEach(b=>{if(b)b.textContent=_dark?'โ๏ธ':'๐';});
}

// โโโโโโโโ PRODUCT FULL PAGE โโโโโโโโ
function openProdPage(id){
  const p=products.find(x=>x.id===id);
  if(!p)return;
  currentPd=p; pdQty=1;
  const cur=C.store.currency||'ุฑ.ุณ';
  const disc=p.oldPrice?Math.round((1-p.price/p.oldPrice)*100):0;
  const avail=p.codes?p.codes.filter(c=>!c.used).length:null;
  const sold=avail===0;
  document.getElementById('pfpTitle').textContent=p.name;

  const existingRevs=(window._prodReviews&&window._prodReviews[id])||[];
  const revHtml=existingRevs.length
    ?existingRevs.map(r=>`<div class="rev-card"><div style="display:flex;align-items:center;justify-content:space-between;"><div><div class="rev-author">${r.name}</div><div class="rev-date">${r.date}</div></div><div style="color:var(--st);">${'โ'.repeat(r.stars)}${'โ'.repeat(5-r.stars)}</div></div><div class="rev-text">${r.text}</div></div>`).join('')
    :'<div style="color:var(--gr);font-size:.85rem;text-align:center;padding:1rem;">ูุง ุชูุฌุฏ ุชููููุงุช ุจุนุฏ โ ูู ุงูุฃูู!</div>';

  // ุดุงุฑุฉ ุงูุจุงุฏุฌ
  const badgeHtml = p.badge
    ?`<span class="pbdg ${p.badge==='new'?'bnn':p.badge==='sale'?'bns':'bnh'}" style="position:absolute;top:14px;right:14px;">${p.badge==='new'?'ุฌุฏูุฏ':p.badge==='sale'?`-${disc}%`:'๐ฅ ุงูุฃูุซุฑ'}</span>`:'';

  // ุงููููุฉ ุงููุชุงุญุฉ
  const availHtml = p.codeType!=='none'
    ?`<div class="pfp-avail-badge">${p.codeType==='account'?'๐ค':'๐'} ${avail} ูุชุงุญ</div>`:'';

  document.getElementById('pfpBody').innerHTML=`
  <div class="pfp-layout">

    <!-- ุงูุตูุฑุฉ โ ูููู -->
    <div class="pfp-gallery">
      <div class="pfp-main-img">
        ${badgeHtml}
        ${p.emoji}
        ${availHtml}
      </div>
      <!-- ูููุฒุงุช ุณุฑูุนุฉ ุชุญุช ุงูุตูุฑุฉ -->
      <div class="pfp-features" style="margin-top:1rem;">
        <div class="pfp-feat">โก ุชุณููู ููุฑู ุจุนุฏ ุงูุฏูุน</div>
        <div class="pfp-feat">๐ ุฏูุน ุขูู ููุดูุฑ</div>
        <div class="pfp-feat">๐ง ุฏุนู ููู 24/7</div>
        <div class="pfp-feat">โ ุถูุงู ุณูุฉ ูุงููุฉ</div>
      </div>
    </div>

    <!-- ุงููุนูููุงุช โ ูุณุงุฑ -->
    <div class="pfp-info">
      <div class="pfp-cat-tag">๐ท๏ธ ${C.cats.find(c=>c.key===p.cat)?.label||'ููุชุฌ ุฑููู'}</div>
      <h1 class="pfp-name">${p.name}</h1>

      <div class="pfp-rating-row">
        <span class="pfp-stars">${'โ'.repeat(Math.floor(p.rating))}${'โ'.repeat(5-Math.floor(p.rating))}</span>
        <span class="pfp-rcount">${p.rating} (${p.rCount} ุชูููู)</span>
        ${p.codeType!=='none'?`<span style="margin-right:auto;font-size:.82rem;color:var(--gr);">๐ ${p.rCount*2}+ ูุดุงูุฏุฉ</span>`:''}
      </div>

      <div class="pfp-price-wrap">
        ${p.oldPrice?`<span class="pfp-price-disc">-${disc}%</span><span class="pfp-price-old">${p.oldPrice} ${cur}</span>`:''}
        <div class="pfp-price-main">${p.price} ${cur}</div>
      </div>

      <p class="pfp-desc">${p.desc}</p>

      ${p.codeType!=='none'?`
      <div class="pfp-digital-badge">
        ${p.codeType==='account'?'๐ค':'๐'}
        <div>
          <div style="font-size:.9rem;">ููุชุฌ ุฑููู โ ${p.codeType==='account'?'ุญุณุงุจ ูุดุชุฑู':'ููุฏ ุชูุนูู'}</div>
          <div style="font-size:.78rem;opacity:.7;font-weight:400;">ุชุญุตู ุนูู ุจูุงูุงุชู ููุฑุงู ุจุนุฏ ุฅุชูุงู ุงูุฏูุน</div>
        </div>
      </div>`:''}

      ${sold?`<div style="background:#fee2e2;border:1px solid #fca5a5;border-radius:12px;padding:1rem;text-align:center;color:var(--re);font-weight:800;margin-bottom:1rem;">โ ููุฏ ุงููุฎุฒูู</div>`:`
      <div class="pfp-buy-row">
        <div class="pfp-qty">
          <button onclick="pfpChQ(-1)">โ</button>
          <span id="pfpQty">1</span>
          <button onclick="pfpChQ(1)">+</button>
        </div>
        <button class="pfp-add-btn" onclick="pfpAddToCart()">๐ ุฃุถู ููุณูุฉ</button>
      </div>`}

    </div>
  </div>

  <!-- ุงูุชููููุงุช โ ุชุญุช ุงูุนููุฏูู -->
  <div class="pfp-revs">
    <div class="rev-hd"><div class="rev-ttl">โญ ุชููููุงุช ุงูุนููุงุก (${existingRevs.length})</div></div>
    <div id="pfpRevList">${revHtml}</div>
    ${isLoggedIn?`
    <div class="rev-form">
      <div style="font-size:.88rem;font-weight:700;margin-bottom:.5rem;">ุฃุถู ุชููููู</div>
      <div class="rev-stars-inp" id="pfpStarsInp">
        ${[1,2,3,4,5].map(s=>`<span class="rev-star" data-s="${s}" onclick="pfpSetStar(${s})">โ</span>`).join('')}
      </div>
      <textarea class="fi" id="pfpRevText" placeholder="ุดุงุฑููุง ุชุฌุฑุจุชู ูุน ูุฐุง ุงูููุชุฌ..." rows="3" style="margin-bottom:.7rem;"></textarea>
      <button class="btn-pri" style="width:100%;" onclick="pfpSubmitRev(${p.id})">ูุดุฑ ุงูุชูููู โ</button>
    </div>`:`<div style="text-align:center;font-size:.82rem;color:var(--gr);margin-top:.8rem;"><span style="color:var(--p);cursor:pointer;font-weight:700;" onclick="closeProdPage();openSheet('loginSheet')">ุณุฌูู ุฏุฎููู</span> ูุฅุถุงูุฉ ุชูููู</div>`}
  </div>`;

  history.pushState({page:'product',id},'',`#product-${id}`);
  document.getElementById('prodFullPage').classList.add('open');
  document.body.style.overflow='hidden';
  window.scrollTo(0,0);
  loadProdReviews(id).then(()=>openProdPage._refreshRevs&&openProdPage._refreshRevs(id));
}
function closeProdPage(){
  document.getElementById('prodFullPage').classList.remove('open');
  document.body.style.overflow='';
  if(history.state&&history.state.page==='product')history.back();
}
function pfpChQ(d){pdQty=Math.max(1,pdQty+d);document.getElementById('pfpQty').textContent=pdQty;}
function pfpAddToCart(){for(let i=0;i<pdQty;i++)quickAdd(currentPd.id);closeProdPage();}
let _pfpStars=5;
function pfpSetStar(n){
  _pfpStars=n;
  document.querySelectorAll('.rev-star').forEach((s,i)=>{s.classList.toggle('sel',i<n);});
}
async function pfpSubmitRev(pid){
  const text=document.getElementById('pfpRevText').value.trim();
  if(!text){showToast('ุงูุชุจ ุชููููู ุฃููุงู');return;}
  const rev={name:currentUser.name||'ูุณุชุฎุฏู',date:new Date().toLocaleDateString('ar-SA'),stars:_pfpStars,text};
  if(!window._prodReviews)window._prodReviews={};
  if(!window._prodReviews[pid])window._prodReviews[pid]=[];
  window._prodReviews[pid].unshift(rev);
  // ูุญุงููุฉ ุญูุธ ูู Firestore
  try{await fbDb.collection('productReviews').doc(String(pid)).set({reviews:window._prodReviews[pid]},{merge:true});}catch(e){}
  // ุชุญุฏูุซ ูุงุฆูุฉ ุงูุชููููุงุช
  document.getElementById('pfpRevList').innerHTML=window._prodReviews[pid].map(r=>`<div class="rev-card"><div style="display:flex;align-items:center;justify-content:space-between;"><div><div class="rev-author">${r.name}</div><div class="rev-date">${r.date}</div></div><div style="color:var(--st);">${'โ'.repeat(r.stars)}${'โ'.repeat(5-r.stars)}</div></div><div class="rev-text">${r.text}</div></div>`).join('');
  document.querySelector('.rev-form').innerHTML='<div style="text-align:center;padding:1rem;color:var(--gn);font-weight:700;">โ ุชู ูุดุฑ ุชููููู! ุดูุฑุงู ูู</div>';
  showToast('โ ุชู ูุดุฑ ุชููููู!');
}

// ุชุญููู ุงูุชููููุงุช ูู Firestore
async function loadProdReviews(pid){
  try{
    const doc=await fbDb.collection('productReviews').doc(String(pid)).get();
    if(doc.exists&&doc.data().reviews){
      if(!window._prodReviews)window._prodReviews={};
      window._prodReviews[pid]=doc.data().reviews;
    }
  }catch(e){}
}

// โโโโโโโโ CATEGORY PAGE โโโโโโโโ
function openCatPage(catKey){
  const cat=C.cats.find(c=>c.key===catKey)||{label:catKey==='all'?'ุฌููุน ุงูููุชุฌุงุช':'ุนุฑูุถ ุฎุงุตุฉ',icon:'๐๏ธ',count:''};
  const list=products.filter(p=>p.active&&(catKey==='all'||p.cat===catKey));
  document.getElementById('cpName').textContent=(cat.icon?cat.icon+' ':'')+cat.label;
  document.getElementById('cpCount').textContent=list.length+' ููุชุฌ';
  renderProds(list,'cpGrid');
  history.pushState({page:'category',cat:catKey},'',`#cat-${catKey}`);
  document.getElementById('catPage').classList.add('open');
  document.body.style.overflow='hidden';
  document.getElementById('catPage').scrollTop=0;
}
function closeCatPage(){
  document.getElementById('catPage').classList.remove('open');
  document.body.style.overflow='';
  if(history.state&&history.state.page==='category')history.back();
}

// ุงูุชุนุงูู ูุน ุฒุฑ ุงูุฑุฌูุน
window.addEventListener('popstate',e=>{
  if(document.getElementById('prodFullPage').classList.contains('open')){
    document.getElementById('prodFullPage').classList.remove('open');
    document.body.style.overflow='';
  }
  if(document.getElementById('catPage').classList.contains('open')){
    document.getElementById('catPage').classList.remove('open');
    document.body.style.overflow='';
  }
});

// PRODUCT DETAIL (ุงูุดูุช ุงููุฏูู - ุงุณุชุจุฏููุงู ุจุงูุตูุญุฉ ุงููุงููุฉ)
function openProd(id){openProdPage(id);}
function chQ(d){pfpChQ(d);}
function addFromPd(){pfpAddToCart();}

// CART
function quickAdd(id){
  const p=products.find(x=>x.id===id);
  const avail=p.codeType!=='none'?p.codes.filter(c=>!c.used).length:99;
  const inCart=cart.filter(x=>x.id===id).reduce((s,x)=>s+x.qty,0);
  if(p.codeType!=='none'&&inCart>=avail){showToast('ูุง ููุฌุฏ ูุฎุฒูู ูุงูู');return;}
  const ex=cart.find(x=>x.id===id);
  if(ex)ex.qty++;else cart.push({...p,qty:1});
  document.getElementById('cartCount').textContent=cart.reduce((s,i)=>s+i.qty,0);
  showToast('โ ุชูุช ุงูุฅุถุงูุฉ ููุณูุฉ');
}
function rmCI(id){cart=cart.filter(i=>i.id!==id);document.getElementById('cartCount').textContent=cart.reduce((s,i)=>s+i.qty,0);renderCart();}
function chCI(id,d){const i=cart.find(x=>x.id===id);if(i){i.qty+=d;if(i.qty<=0)rmCI(id);}document.getElementById('cartCount').textContent=cart.reduce((s,i)=>s+i.qty,0);renderCart();}

function renderCart(){
  const cur=C.store.currency||'ุฑ.ุณ',b=document.getElementById('cartBody');
  if(!cart.length){b.innerHTML='<div class="ce"><div style="font-size:3.5rem;">๐</div><p>ุณูุชู ูุงุฑุบุฉ!</p></div>';return;}
  const sub=cart.reduce((s,i)=>s+i.price*i.qty,0);
  const ship=sub>=C.store.freeShip?0:C.store.shipFee;
  b.innerHTML=cart.map(i=>`
    <div class="ci"><div class="ci-img">${i.emoji}</div>
    <div class="ci-info">
      <div class="ci-nm">${i.name}${i.codeType!=='none'?`<span style="font-size:.65rem;color:var(--p);background:rgba(109,40,217,.1);padding:.1rem .4rem;border-radius:4px;margin-right:.4rem;">${i.codeType==='account'?'๐ค':'๐'}</span>`:''}</div>
      <div class="ci-pr">${i.price} ${cur}</div>
      <div class="ci-qty"><button onclick="chCI(${i.id},-1)">โ</button><span>${i.qty}</span><button onclick="chCI(${i.id},1)">+</button></div>
    </div><button class="ci-rm" onclick="rmCI(${i.id})">โ</button></div>`).join('')+`
  <div class="csum"><div class="crow"><span>ุงููุฌููุน</span><span>${sub} ${cur}</span></div><div class="crow"><span>ุงูุดุญู</span><span>${ship?ship+' '+cur:'ูุฌุงูู'}</span></div><div class="crow tot"><span>ุงูุฅุฌูุงูู</span><span>${sub+ship} ${cur}</span></div></div>
  <button class="btn-co" onclick="openCheckout()">ุฅุชูุงู ุงูุทูุจ โ</button>`;
}

// CHECKOUT
function openCheckout(){
  if(!isLoggedIn){closeSheet('cartSheet');openSheet('loginSheet');showToast('ุณุฌูู ุฏุฎููู ุฃููุงู');return;}
  const cur=C.store.currency||'ุฑ.ุณ';
  const sub=cart.reduce((s,i)=>s+i.price*i.qty,0);
  const ship=sub>=C.store.freeShip?0:C.store.shipFee;
  const tot=sub+ship,hasD=cart.some(i=>i.codeType!=='none');
  const payOpts=['๐ณ ุจุทุงูุฉ ูุฏู / ุงุฆุชูุงููุฉ','๐ Apple Pay','๐ฑ STC Pay'];
  if(C.store.cod&&!hasD)payOpts.push('๐ต ุงูุฏูุน ุนูุฏ ุงูุงุณุชูุงู');
  document.getElementById('coBody').innerHTML=`
    ${hasD?'<div style="background:rgba(109,40,217,.06);border:1px solid rgba(109,40,217,.15);border-radius:11px;padding:.8rem 1rem;margin-bottom:1rem;font-size:.85rem;">โก <strong>ููุชุฌุงุช ุฑูููุฉ</strong> โ ุณุชุญุตู ุนูู ููุฏู ููุฑุงู</div>':''}
    <div class="fg"><label class="fl">ุงูุงุณู ุงููุงูู</label><input type="text" class="fi" id="coName" value="${currentUser?.name||''}" placeholder="ูุญูุฏ ุนุจุฏุงููู"></div>
    <div class="fg"><label class="fl">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู</label><input type="email" class="fi" id="coEmail" value="${currentUser?.email||''}" readonly style="background:#f8f7ff;color:var(--gr);"></div>
    ${!hasD?'<div class="fg"><label class="fl">ุงูุนููุงู</label><input type="text" class="fi" id="coAddr" placeholder="ุงููุฏููุฉุ ุงูุญูุ ุงูุดุงุฑุน"></div>':''}
    <div class="fg"><label class="fl">ุทุฑููุฉ ุงูุฏูุน</label>
      <div class="pay-opts">${payOpts.map((o,i)=>`<div class="pay-opt${i===0?' sel':''}" onclick="selPay(this)">${o}</div>`).join('')}</div>
    </div>
    <div class="csum"><div class="crow"><span>ุงููุฌููุน</span><span>${sub} ${cur}</span></div><div class="crow"><span>ุงูุดุญู</span><span>${ship?ship+' '+cur:'ูุฌุงูู'}</span></div><div class="crow tot"><span>ุงูุฅุฌูุงูู</span><span>${tot} ${cur}</span></div></div>
    <button class="btn-pri" id="placeOrderBtn" onclick="placeOrder(${tot})">โ ุชุฃููุฏ ุงูุทูุจ ูุงูุฏูุน</button>`;
  closeSheet('cartSheet');openSheet('coSheet');
}
function selPay(el){document.querySelectorAll('.pay-opt').forEach(e=>e.classList.remove('sel'));el.classList.add('sel');}

// โโโโโโโโ ๐ฅ PLACE ORDER โโโโโโโโ
async function placeOrder(tot){
  const btn=document.getElementById('placeOrderBtn');
  if(btn){btn.disabled=true;btn.textContent='โณ ุฌุงุฑู ุชุฃููุฏ ุงูุทูุจ...';}

  const name=document.getElementById('coName')?.value?.trim()||'';
  const email=currentUser?.email||'';
  if(!name){showToast('ูุฑุฌู ุฅุฏุฎุงู ุงุณูู');if(btn){btn.disabled=false;btn.textContent='โ ุชุฃููุฏ ุงูุทูุจ ูุงูุฏูุน';}return;}

  const cur=C.store.currency||'ุฑ.ุณ';
  const orderId=await getNextOrderNum(); // ๐ฅ ุฑูู ูู Firebase
  const payMethod=document.querySelector('.pay-opt.sel')?.textContent?.trim()||'ุจุทุงูุฉ';
  const date=new Date().toLocaleDateString('ar-SA');

  // ุชุนููู ุงูุฃููุงุฏ ูู localStorage
  const delivered=[];
  cart.forEach(item=>{
    if(item.codeType==='none')return;
    const prod=products.find(p=>p.id===item.id);
    for(let q=0;q<item.qty;q++){
      const a=prod.codes.find(c=>!c.used);
      if(a){a.used=true;delivered.push({product:item,code:a});}
    }
  });
  try{localStorage.setItem('storeProducts',JSON.stringify(products));}catch(e){}

  // ุชุญุฏูุซ ุงุณู ุงูุนููู
  if(currentUser&&name)currentUser.name=name;

  // ๐ฅ ุญูุธ ูู Firestore
  if(currentUser?.uid){
    await fbUpsertCustomer(currentUser.uid,email,name,currentUser.joinDate);
    const orderRecord={
      id:orderId,date,
      products:cart.map(i=>i.emoji+' '+i.name+'('+i.qty+')').join('ุ '),
      total:tot,status:'done',payMethod,currency:cur,
      codes:delivered.map(d=>d.product.codeType==='account'
        ?{type:'account',product:d.product.name,user:d.code.user,pass:d.code.pass,note:d.code.note||''}
        :{type:'code',product:d.product.name,val:d.code.val}
      )
    };
    await fbSaveOrder(currentUser.uid,orderRecord);
  }

  updateLoginBtn();
  closeSheet('coSheet');
  cart=[];
  document.getElementById('cartCount').textContent=0;
  refreshProds();

  if(delivered.length){showDelivery(orderId,name,email,tot,cur,delivered);}
  else{
    if(C.delivery.sendOwner)notifyOwner(orderId,name,email,tot,[]);
    showToast('โ ุชู ุชุฃููุฏ ุทูุจู '+orderId+' ุณูุชูุงุตู ูุนู ูุฑูุจุงู.');
  }
}

function buildMsg(orderId,name,delivered){
  let block='';
  delivered.forEach(d=>{block+=d.product.codeType==='account'
    ?`${d.product.emoji} ${d.product.name}\n๐ค ุงูููุฒุฑ: ${d.code.user}\n๐ ุงูุจุงุณูุฑุฏ: ${d.code.pass}${d.code.note?'\n๐ '+d.code.note:''}\n\n`
    :`${d.product.emoji} ${d.product.name}\n๐ ุงูููุฏ: ${d.code.val}\n\n`;});
  return (C.delivery.msg||DEF.delivery.msg)
    .replace('{store}',C.meta.name).replace('{order}',orderId)
    .replace('{product}',delivered.map(d=>d.product.name).join('ุ ')).replace('{codeBlock}',block.trim());
}

function notifyOwner(orderId,name,email,tot,delivered){
  const msg=`๐ ุทูุจ ุฌุฏูุฏ!\n\nุฑูู: ${orderId}\nุงูุนููู: ${name}\nุงูุจุฑูุฏ: ${email}\nุงูุฅุฌูุงูู: ${tot} ${C.store.currency||'ุฑ.ุณ'}`;
  const wa=C.delivery.ownerWA||'';
  if(wa)setTimeout(()=>window.open(`https://wa.me/${wa}?text=${encodeURIComponent(msg)}`,'_blank'),800);
}

function showDelivery(orderId,name,email,tot,cur,delivered){
  const hasAcc=delivered.some(d=>d.product.codeType==='account');
  document.getElementById('dlvHead').innerHTML=`<div class="dlv-ic">${hasAcc?'๐ค':'๐'}</div><div class="dlv-ttl">ุชู ุชุฃููุฏ ุทูุจู! ๐</div><div class="dlv-sub">ุฅููู ูุญุชูุงู ุงูุฑููู โ ุงุญุชูุธ ุจู ุจุฃูุงู</div>`;
  document.getElementById('dlvHead').style.background=`linear-gradient(135deg,${C.colors.primary},${C.colors.secondary})`;
  document.getElementById('dlvInfo').innerHTML=`
    <div><div class="di-l">ุฑูู ุงูุทูุจ</div><div class="di-v">${orderId}</div></div>
    <div><div class="di-l">ุงูุฅุฌูุงูู</div><div class="di-v">${tot} ${cur}</div></div>
    <div><div class="di-l">ุงูููุชุฌุงุช</div><div class="di-v">${delivered.map(d=>d.product.name).join('ุ ')}</div></div>`;
  let codesHtml='';
  delivered.forEach(d=>{
    if(d.product.codeType==='account'){
      const cp=`${d.code.user} / ${d.code.pass}`;
      codesHtml+=`${delivered.length>1?`<div style="font-size:.75rem;color:rgba(255,255,255,.4);margin:.6rem 0 .3rem;">${d.product.emoji} ${d.product.name}</div>`:''}
        <div class="acc-box">
          <div class="acc-row"><span class="acc-l">ุงูุจุฑูุฏ / ุงูููุฒุฑ</span><span class="acc-v">${d.code.user}</span></div>
          <div class="acc-row"><span class="acc-l">ูููุฉ ุงููุฑูุฑ</span><span class="acc-v">${d.code.pass}</span></div>
          ${d.code.note?`<div class="acc-row"><span class="acc-l">ููุงุญุธุฉ</span><span class="acc-v" style="color:var(--ac);">${d.code.note}</span></div>`:''}
        </div>
        <button class="btn-cp" onclick="cpTxt('${cp.replace(/'/g,"\\'")}')">๐ ูุณุฎ ุงูุจูุงูุงุช</button>`;
    }else{
      codesHtml+=`${delivered.length>1?`<div style="font-size:.75rem;color:rgba(255,255,255,.4);margin:.6rem 0 .3rem;">${d.product.emoji} ${d.product.name}</div>`:''}
        <div class="code-box"><div class="code-lbl">ุงูููุฏ ุงูุฎุงุต ุจู</div><div class="code-val">${d.code.val}</div></div>
        <button class="btn-cp" onclick="cpTxt('${d.code.val}')">๐ ูุณุฎ ุงูููุฏ</button>`;
    }
  });
  const custMsg=buildMsg(orderId,name,delivered);
  codesHtml+=`<div class="wa-row">
    ${C.delivery.sendOwner?`<button class="btn-wa-o" onclick="notifyOwner('${orderId}','${name}','${email}',${tot},[])">๐ ุฅุดุนุงุฑ ุงููุชุฌุฑ</button>`:''}
  </div>`;
  document.getElementById('dlvCodes').innerHTML=codesHtml;
  document.getElementById('dlvOv').classList.add('open');
  if(C.delivery.sendOwner)notifyOwner(orderId,name,email,tot,delivered);
}
function closeDlv(){document.getElementById('dlvOv').classList.remove('open');}
function cpTxt(t){navigator.clipboard.writeText(t).then(()=>showToast('โ ุชู ุงููุณุฎ!'));}

// โโโโโโโโ MY ORDERS (Firebase) โโโโโโโโ
async function openMyOrders(){
  if(!isLoggedIn||!currentUser){openSheet('loginSheet');return;}
  const cur=C.store.currency||'ุฑ.ุณ';
  document.getElementById('myOrdersName').textContent=currentUser.name||currentUser.email;
  document.getElementById('myOrdersPhone').textContent=currentUser.email||'';
  document.getElementById('myOrdersJoin').textContent=currentUser.joinDate||'';
  document.getElementById('myOrdersList').innerHTML='<div style="text-align:center;padding:2rem;color:var(--p);"><span class="spin">โ</span> ุฌุงุฑู ุชุญููู ุทูุจุงุชู...</div>';
  openSheet('myOrdersSheet');

  const orders=await fbGetOrders(currentUser.uid);
  document.getElementById('myOrdersCount').textContent=orders.length+' ุทูุจ';
  document.getElementById('myOrdersList').innerHTML=orders.length
    ?orders.map(o=>`
      <div style="background:#f8f7ff;border:1px solid var(--bd);border-radius:12px;padding:1rem;margin-bottom:.8rem;">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:.6rem;">
          <div><strong style="color:var(--p);font-size:.95rem;">${o.id}</strong> <span style="font-size:.72rem;color:var(--gr);">${o.date}</span></div>
          <span style="font-size:.8rem;font-weight:800;color:var(--p);">${o.total} ${o.currency||cur}</span>
        </div>
        <div style="font-size:.82rem;color:var(--tx2);margin-bottom:.6rem;">${o.products}</div>
        ${o.codes&&o.codes.length?`<div style="background:#fff;border:1px solid rgba(109,40,217,.15);border-radius:8px;padding:.6rem .8rem;">
          ${o.codes.map(c=>c.type==='account'
            ?`<div style="font-size:.78rem;margin-bottom:.3rem;"><span style="color:var(--gr);">${c.product}:</span> ๐ค <span style="font-family:monospace;font-weight:700;">${c.user}</span> / <span style="font-family:monospace;">${c.pass}</span>${c.note?` [${c.note}]`:''}</div>`
            :`<div style="font-size:.78rem;margin-bottom:.3rem;"><span style="color:var(--gr);">${c.product}:</span> ๐ <span style="font-family:monospace;font-weight:700;color:var(--p);">${c.val}</span></div>`
          ).join('')}
        </div>`:''}
        <div style="display:flex;align-items:center;justify-content:space-between;margin-top:.6rem;">
          <span style="font-size:.73rem;color:var(--gr);">${o.payMethod||''}</span>
          <span style="font-size:.72rem;font-weight:700;color:var(--gn);">โ ููุชูู</span>
        </div>
      </div>`).join('')
    :'<div style="text-align:center;padding:2rem;color:var(--gr);"><div style="font-size:2.5rem;">๐</div><p style="margin-top:.5rem;">ูุง ุชูุฌุฏ ุทูุจุงุช ุจุนุฏ</p></div>';
}

// โโโโโโโโ TOAST โโโโโโโโ
let _toastT;
function showToast(msg){const t=document.getElementById('toast');t.textContent=msg;t.classList.add('show');clearTimeout(_toastT);_toastT=setTimeout(()=>t.classList.remove('show'),2600);}

// โโ LIVE SYNC (localStorage fallback) โโ
window.addEventListener('storage',e=>{if(e.key==='storeConfig'||e.key==='storeProducts')location.reload();});

// โโ INIT โ Firestore ุฃููุงู โโ
initStore();

</script>
</body>
</html>
